var Location={LOCATION_DEBUG:false,options:{maximumAge:3e5,timeout:6e4,enableHighAccuracy:true},geocodeCurrentAttempt:1,geocodeMaxAttempts:3,geocodeDelayBetweenAttempts:2e3,vectorDistance:function(dx,dy){return Math.sqrt(dx*dx+dy*dy)},locationDistance:function(location1,location2){var dx=location1.latitude-location2.latitude,dy=location1.longitude-location2.longitude;return this.vectorDistance(dx,dy)},deg2rad:function(deg){return deg*(Math.PI/180)},locationDistanceInKilometers:function(location1,location2){var R=6371;var dLat=this.deg2rad(location2.latitude-location1.latitude);var dLon=this.deg2rad(location2.longitude-location1.longitude);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(this.deg2rad(location1.latitude))*Math.cos(this.deg2rad(location2.latitude))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d},closestLocation:function(targetLocation,locations){return locations.reduce(function(prev,curr){var prevDistance=this.locationDistance(targetLocation,prev.coords),currDistance=this.locationDistance(targetLocation,curr.coords);return prevDistance<currDistance?prev:curr}.bind(this))},geolocationIsSupported:function(){return navigator.geolocation},tryToRecoverPosition:function(callbackSuccess,callbackFailure){if(sessionStorage.hasOwnProperty("currentPosition")){if(sessionStorage.getItem("currentPosition")==="[object Object]"){sessionStorage.removeItem("currentPosition")}}if(sessionStorage.hasOwnProperty("currentPosition")){var currentPosition=typeof sessionStorage.getItem("currentPosition")==="string"?JSON.parse(sessionStorage.getItem("currentPosition")):sessionStorage.getItem("currentPosition");callbackSuccess(currentPosition)}if(typeof navigator!==undefined&&typeof navigator.geolocation!==undefined&&typeof navigator.geolocation.getCurrentPosition==="function"&&!sessionStorage.hasOwnProperty("currentPosition")){navigator.geolocation.getCurrentPosition(function(position){sessionStorage.setItem("currentPosition",JSON.stringify({coords:{latitude:position.coords.latitude,longitude:position.coords.longitude}}));callbackSuccess(position)},callbackFailure,this.options)}},setNoPosition:function(){sessionStorage.setItem("currentPosition",JSON.stringify({}))},currentPosition:function(callback,callbackFailure){var callbackSuccess=function(position){callback(position)}.bind(this);this.tryToRecoverPosition(callbackSuccess,callbackFailure)},closestLocationOfCurrentPosition:function(locations,callback,callbackFailure){var callbackSuccess=function(position){var closestLocation=this.closestLocation(position.coords,locations);callback(position,closestLocation)}.bind(this);this.tryToRecoverPosition(callbackSuccess,callbackFailure)},findLocalityByGeocodeResponse:function(result,addressComponentType){try{return result.address[addressComponentType]}catch(e){return"La tua posizione"}},cityNearPosition:function(position,callback,callbackFailure){if(!window&&!window.L&&!window.L.esri){if(typeof callbackFailure==="function"){callbackFailure()}return}if(window&&window.L&&L.esri&&L.esri.Geocoding){L.esri.Geocoding.reverseGeocode().latlng([position.coords.latitude,position.coords.longitude]).run(function(error,result){if(!error){callback(this.findLocalityByGeocodeResponse(result,"City"))}else{callbackFailure()}}.bind(this))}},countryNearPosition:function(position,callback,callbackFailure){if(!window&&!window.L&&!window.L.esri){if(typeof callbackFailure==="function"){callbackFailure()}return}if(window&&window.L&&L.esri&&L.esri.Geocoding){L.esri.Geocoding.reverseGeocode().latlng([position.coords.latitude,position.coords.longitude]).run(function(error,result){if(!error){callback(this.findLocalityByGeocodeResponse(result,"CountryCode"))}else{callbackFailure()}}.bind(this))}},getDataToPassAsPostParam:function(position,cityName,country){return{name:"current-position",customName:cityName,country:country,coords:{latitude:position.coords.latitude,longitude:position.coords.longitude}}},isCurrentPositionInDomainCountry:function(currentPosition){if(this.LOCATION_DEBUG){console.log("PRE isCurrentPositionInDomainCountry",currentPosition)}if(!currentPosition){return false}if(this.LOCATION_DEBUG){console.log("POST isCurrentPositionInDomainCountry",domainData&&domainData.default_locale&&domainData.default_locale===navigator.language.substring(0,2))}return domainData&&domainData.default_locale&&domainData.default_locale===navigator.language.substring(0,2)},isMobileOrTable:function(){var check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check}};
(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("react"));else if(typeof define==="function"&&define.amd)define(["react"],factory);else if(typeof exports==="object")exports["MaskedInput"]=factory(require("react"));else root["MaskedInput"]=factory(root["React"])})(this,function(__WEBPACK_EXTERNAL_MODULE_2__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var React=__webpack_require__(2);var InputMask=__webpack_require__(1);var KEYCODE_Z=90;var KEYCODE_Y=89;function isUndo(e){return(e.ctrlKey||e.metaKey)&&e.keyCode===(e.shiftKey?KEYCODE_Y:KEYCODE_Z)}function isRedo(e){return(e.ctrlKey||e.metaKey)&&e.keyCode===(e.shiftKey?KEYCODE_Z:KEYCODE_Y)}function getSelection(el){var start,end,rangeEl,clone;if(el.selectionStart!==undefined){start=el.selectionStart;end=el.selectionEnd}else{try{el.focus();rangeEl=el.createTextRange();clone=rangeEl.duplicate();rangeEl.moveToBookmark(document.selection.createRange().getBookmark());clone.setEndPoint("EndToStart",rangeEl);start=clone.text.length;end=start+rangeEl.text.length}catch(e){}}return{start:start,end:end}}function setSelection(el,selection){var rangeEl;try{if(el.selectionStart!==undefined){el.focus();el.setSelectionRange(selection.start,selection.end)}else{el.focus();rangeEl=el.createTextRange();rangeEl.collapse(true);rangeEl.moveStart("character",selection.start);rangeEl.moveEnd("character",selection.end-selection.start);rangeEl.select()}}catch(e){}}var MaskedInput=React.createClass({displayName:"MaskedInput",propTypes:{mask:React.PropTypes.string.isRequired,formatCharacters:React.PropTypes.object,placeholderChar:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{value:""}},componentWillMount:function componentWillMount(){var options={pattern:this.props.mask,value:this.props.value,formatCharacters:this.props.formatCharacters};if(this.props.placeholderChar){options.placeholderChar=this.props.placeholderChar}this.mask=new InputMask(options)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.mask!==nextProps.mask&&this.props.value!==nextProps.mask){if(this.mask.getValue()===this.mask.emptyValue){this.mask.setPattern(nextProps.mask,{value:nextProps.value})}else{this.mask.setPattern(nextProps.mask,{value:this.mask.getRawValue()})}}else if(this.props.mask!==nextProps.mask){this.mask.setPattern(nextProps.mask,{value:this.mask.getRawValue()})}else if(this.props.value!==nextProps.value){this.mask.setValue(nextProps.value)}},componentWillUpdate:function componentWillUpdate(nextProps,nextState){if(nextProps.mask!==this.props.mask){this._updatePattern(nextProps)}},componentDidUpdate:function componentDidUpdate(prevProps){if(prevProps.mask!==this.props.mask&&this.mask.selection.start){this._updateInputSelection()}},_updatePattern:function _updatePattern(props){this.mask.setPattern(props.mask,{value:this.mask.getRawValue(),selection:getSelection(this.input)})},_updateMaskSelection:function _updateMaskSelection(){this.mask.selection=getSelection(this.input);setTimeout(function(){this.input.setSelectionRange(this.mask.selection.start,this.mask.selection.end)}.bind(this),1)},_updateInputSelection:function _updateInputSelection(){setSelection(this.input,this.mask.selection)},_onChange:function _onChange(e){var maskValue=this.mask.getValue();if(e.target.value!==maskValue){if(e.target.value.length<maskValue.length){var sizeDiff=maskValue.length-e.target.value.length;this._updateMaskSelection();this.mask.selection.end=this.mask.selection.start+sizeDiff;this.mask.backspace()}var value=this._getDisplayValue();e.target.value=value;if(value){this._updateInputSelection()}}if(this.props.onChange){this.props.onChange(e)}},_onKeyDown:function _onKeyDown(e){if(isUndo(e)){e.preventDefault();if(this.mask.undo()){e.target.value=this._getDisplayValue();this._updateInputSelection();if(this.props.onChange){this.props.onChange(e)}}return}else if(isRedo(e)){e.preventDefault();if(this.mask.redo()){e.target.value=this._getDisplayValue();this._updateInputSelection();if(this.props.onChange){this.props.onChange(e)}}return}if(e.key==="Backspace"){e.preventDefault();this._updateMaskSelection();if(this.mask.backspace()){var value=this._getDisplayValue();e.target.value=value;if(value){this._updateInputSelection()}if(this.props.onChange){this.props.onChange(e)}}}},_onKeyPress:function _onKeyPress(e){if(e.metaKey||e.altKey||e.ctrlKey||e.key==="Enter"){return}e.preventDefault();this._updateMaskSelection();if(this.mask.input(e.key||e.data)){e.target.value=this.mask.getValue();this._updateInputSelection();if(this.props.onChange){this.props.onChange(e)}}},_onPaste:function _onPaste(e){e.preventDefault();this._updateMaskSelection();if(this.mask.paste(e.clipboardData.getData("Text"))){e.target.value=this.mask.getValue();setTimeout(this._updateInputSelection,0);if(this.props.onChange){this.props.onChange(e)}}},_getDisplayValue:function _getDisplayValue(){var value=this.mask.getValue();return value===this.mask.emptyValue?"":value},_keyPressPropName:function _keyPressPropName(){return"onKeyPress"},_getEventHandlers:function _getEventHandlers(){return _defineProperty({onChange:this._onChange,onKeyDown:this._onKeyDown,onPaste:this._onPaste},this._keyPressPropName(),this._onKeyPress)},focus:function focus(){this.input.focus()},blur:function blur(){this.input.blur()},render:function render(){var _this=this;var ref=function ref(r){return _this.input=r};var maxLength=this.mask.pattern.length;var value=this._getDisplayValue();var eventHandlers=this._getEventHandlers();var _props=this.props;var _props$size=_props.size;var size=_props$size===undefined?maxLength:_props$size;var _props$placeholder=_props.placeholder;var placeholder=_props$placeholder===undefined?this.mask.emptyValue:_props$placeholder;var _props2=this.props;var placeholderChar=_props2.placeholderChar;var formatCharacters=_props2.formatCharacters;var cleanedProps=_objectWithoutProperties(_props2,["placeholderChar","formatCharacters"]);var inputProps=_extends({},cleanedProps,eventHandlers,{ref:ref,maxLength:maxLength,value:value,size:size,placeholder:placeholder});return React.createElement("input",inputProps)}});module.exports=MaskedInput},function(module,exports){"use strict";function extend(dest,src){if(src){var props=Object.keys(src);for(var i=0,l=props.length;i<l;i++){dest[props[i]]=src[props[i]]}}return dest}function copy(obj){return extend({},obj)}function mergeFormatCharacters(formatCharacters){var merged=copy(DEFAULT_FORMAT_CHARACTERS);if(formatCharacters){var chars=Object.keys(formatCharacters);for(var i=0,l=chars.length;i<l;i++){var char=chars[i];if(formatCharacters[char]==null){delete merged[char]}else{merged[char]=formatCharacters[char]}}}return merged}var ESCAPE_CHAR="\\";var DIGIT_RE=/^\d$/;var LETTER_RE=/^[A-Za-z]$/;var ALPHANNUMERIC_RE=/^[\dA-Za-z]$/;var DEFAULT_PLACEHOLDER_CHAR="_";var DEFAULT_FORMAT_CHARACTERS={"*":{validate:function(char){return ALPHANNUMERIC_RE.test(char)}},1:{validate:function(char){return DIGIT_RE.test(char)}},a:{validate:function(char){return LETTER_RE.test(char)}},A:{validate:function(char){return LETTER_RE.test(char)},transform:function(char){return char.toUpperCase()}},"#":{validate:function(char){return ALPHANNUMERIC_RE.test(char)},transform:function(char){return char.toUpperCase()}}};function Pattern(source,formatCharacters,placeholderChar,isRevealingMask){if(!(this instanceof Pattern)){return new Pattern(source,formatCharacters,placeholderChar)}this.placeholderChar=placeholderChar||DEFAULT_PLACEHOLDER_CHAR;this.formatCharacters=formatCharacters||DEFAULT_FORMAT_CHARACTERS;this.source=source;this.pattern=[];this.length=0;this.firstEditableIndex=null;this.lastEditableIndex=null;this._editableIndices={};this.isRevealingMask=isRevealingMask||false;this._parse()}Pattern.prototype._parse=function parse(){var sourceChars=this.source.split("");var patternIndex=0;var pattern=[];for(var i=0,l=sourceChars.length;i<l;i++){var char=sourceChars[i];if(char===ESCAPE_CHAR){if(i===l-1){throw new Error("InputMask: pattern ends with a raw "+ESCAPE_CHAR)}char=sourceChars[++i]}else if(char in this.formatCharacters){if(this.firstEditableIndex===null){this.firstEditableIndex=patternIndex}this.lastEditableIndex=patternIndex;this._editableIndices[patternIndex]=true}pattern.push(char);patternIndex++}if(this.firstEditableIndex===null){throw new Error('InputMask: pattern "'+this.source+'" does not contain any editable characters.')}this.pattern=pattern;this.length=pattern.length};Pattern.prototype.formatValue=function format(value){var valueBuffer=new Array(this.length);var valueIndex=0;for(var i=0,l=this.length;i<l;i++){if(this.isEditableIndex(i)){if(this.isRevealingMask&&value.length<=valueIndex&&!this.isValidAtIndex(value[valueIndex],i)){break}valueBuffer[i]=value.length>valueIndex&&this.isValidAtIndex(value[valueIndex],i)?this.transform(value[valueIndex],i):this.placeholderChar;valueIndex++}else{valueBuffer[i]=this.pattern[i];if(value.length>valueIndex&&value[valueIndex]===this.pattern[i]){valueIndex++}}}return valueBuffer};Pattern.prototype.isEditableIndex=function isEditableIndex(index){return!!this._editableIndices[index]};Pattern.prototype.isValidAtIndex=function isValidAtIndex(char,index){return this.formatCharacters[this.pattern[index]].validate(char)};Pattern.prototype.transform=function transform(char,index){var format=this.formatCharacters[this.pattern[index]];return typeof format.transform=="function"?format.transform(char):char};function InputMask(options){if(!(this instanceof InputMask)){return new InputMask(options)}options=extend({formatCharacters:null,pattern:null,isRevealingMask:false,placeholderChar:DEFAULT_PLACEHOLDER_CHAR,selection:{start:0,end:0},value:""},options);if(options.pattern==null){throw new Error("InputMask: you must provide a pattern.")}if(typeof options.placeholderChar!=="string"||options.placeholderChar.length>1){throw new Error("InputMask: placeholderChar should be a single character or an empty string.")}this.placeholderChar=options.placeholderChar;this.formatCharacters=mergeFormatCharacters(options.formatCharacters);this.setPattern(options.pattern,{value:options.value,selection:options.selection,isRevealingMask:options.isRevealingMask})}InputMask.prototype.input=function input(char){if(this.selection.start===this.selection.end&&this.selection.start===this.pattern.length){return false}var selectionBefore=copy(this.selection);var valueBefore=this.getValue();var inputIndex=this.selection.start;if(inputIndex<this.pattern.firstEditableIndex){inputIndex=this.pattern.firstEditableIndex}if(this.pattern.isEditableIndex(inputIndex)){if(!this.pattern.isValidAtIndex(char,inputIndex)){return false}this.value[inputIndex]=this.pattern.transform(char,inputIndex)}var end=this.selection.end-1;while(end>inputIndex){if(this.pattern.isEditableIndex(end)){this.value[end]=this.placeholderChar}end--}this.selection.start=this.selection.end=inputIndex+1;while(this.pattern.length>this.selection.start&&!this.pattern.isEditableIndex(this.selection.start)){this.selection.start++;this.selection.end++}if(this._historyIndex!=null){this._history.splice(this._historyIndex,this._history.length-this._historyIndex);this._historyIndex=null}if(this._lastOp!=="input"||selectionBefore.start!==selectionBefore.end||this._lastSelection!==null&&selectionBefore.start!==this._lastSelection.start){this._history.push({value:valueBefore,selection:selectionBefore,lastOp:this._lastOp})}this._lastOp="input";this._lastSelection=copy(this.selection);return true};InputMask.prototype.backspace=function backspace(){if(this.selection.start===0&&this.selection.end===0){return false}var selectionBefore=copy(this.selection);var valueBefore=this.getValue();if(this.selection.start===this.selection.end){if(this.pattern.isEditableIndex(this.selection.start-1)){this.value[this.selection.start-1]=this.placeholderChar}this.selection.start--;this.selection.end--}else{var end=this.selection.end-1;while(end>=this.selection.start){if(this.pattern.isEditableIndex(end)){this.value[end]=this.placeholderChar}end--}this.selection.end=this.selection.start}if(this._historyIndex!=null){this._history.splice(this._historyIndex,this._history.length-this._historyIndex)}if(this._lastOp!=="backspace"||selectionBefore.start!==selectionBefore.end||this._lastSelection!==null&&selectionBefore.start!==this._lastSelection.start){this._history.push({value:valueBefore,selection:selectionBefore,lastOp:this._lastOp})}this._lastOp="backspace";this._lastSelection=copy(this.selection);return true};InputMask.prototype.paste=function paste(input){var initialState={value:this.value.slice(),selection:copy(this.selection),_lastOp:this._lastOp,_history:this._history.slice(),_historyIndex:this._historyIndex,_lastSelection:copy(this._lastSelection)};if(this.selection.start<this.pattern.firstEditableIndex){for(var i=0,l=this.pattern.firstEditableIndex-this.selection.start;i<l;i++){if(input.charAt(i)!==this.pattern.pattern[i]){return false}}input=input.substring(this.pattern.firstEditableIndex-this.selection.start);this.selection.start=this.pattern.firstEditableIndex}for(i=0,l=input.length;i<l&&this.selection.start<=this.pattern.lastEditableIndex;i++){var valid=this.input(input.charAt(i));if(!valid){if(this.selection.start>0){var patternIndex=this.selection.start-1;if(!this.pattern.isEditableIndex(patternIndex)&&input.charAt(i)===this.pattern.pattern[patternIndex]){continue}}extend(this,initialState);return false}}return true};InputMask.prototype.undo=function undo(){if(this._history.length===0||this._historyIndex===0){return false}var historyItem;if(this._historyIndex==null){this._historyIndex=this._history.length-1;historyItem=this._history[this._historyIndex];var value=this.getValue();if(historyItem.value!==value||historyItem.selection.start!==this.selection.start||historyItem.selection.end!==this.selection.end){this._history.push({value:value,selection:copy(this.selection),lastOp:this._lastOp,startUndo:true})}}else{historyItem=this._history[--this._historyIndex]}this.value=historyItem.value.split("");this.selection=historyItem.selection;this._lastOp=historyItem.lastOp;return true};InputMask.prototype.redo=function redo(){if(this._history.length===0||this._historyIndex==null){return false}var historyItem=this._history[++this._historyIndex];if(this._historyIndex===this._history.length-1){this._historyIndex=null;if(historyItem.startUndo){this._history.pop()}}this.value=historyItem.value.split("");this.selection=historyItem.selection;this._lastOp=historyItem.lastOp;return true};InputMask.prototype.setPattern=function setPattern(pattern,options){options=extend({selection:{start:0,end:0},value:""},options);this.pattern=new Pattern(pattern,this.formatCharacters,this.placeholderChar,options.isRevealingMask);this.setValue(options.value);this.emptyValue=this.pattern.formatValue([]).join("");this.selection=options.selection;this._resetHistory()};InputMask.prototype.setSelection=function setSelection(selection){this.selection=copy(selection);if(this.selection.start===this.selection.end){if(this.selection.start<this.pattern.firstEditableIndex){this.selection.start=this.selection.end=this.pattern.firstEditableIndex;return true}var index=this.selection.start;while(index>=this.pattern.firstEditableIndex){if(this.pattern.isEditableIndex(index-1)&&this.value[index-1]!==this.placeholderChar||index===this.pattern.firstEditableIndex){this.selection.start=this.selection.end=index;break}index--}return true}return false};InputMask.prototype.setValue=function setValue(value){if(value==null){value=""}this.value=this.pattern.formatValue(value.split(""))};InputMask.prototype.getValue=function getValue(){return this.value.join("")};InputMask.prototype.getRawValue=function getRawValue(){var rawValue=[];for(var i=0;i<this.value.length;i++){if(this.pattern._editableIndices[i]===true){rawValue.push(this.value[i])}}return rawValue.join("")};InputMask.prototype._resetHistory=function _resetHistory(){this._history=[];this._historyIndex=null;this._lastOp=null;this._lastSelection=copy(this.selection)};InputMask.Pattern=Pattern;module.exports=InputMask},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_2__}])});
"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var YellowPass=function(_BaseComponent){_inherits(YellowPass,_BaseComponent);function YellowPass(props){_classCallCheck(this,YellowPass);var _this=_possibleConstructorReturn(this,(YellowPass.__proto__||Object.getPrototypeOf(YellowPass)).call(this,props));_this.state={giftCard:_this.props.giftCard,loader:true};return _this}_createClass(YellowPass,[{key:"componentDidMount",value:function componentDidMount(){this.retriveGiftcardHistory()}},{key:"retriveGiftcardHistory",value:function retriveGiftcardHistory(){var self=this;var preloadedState=sessionStorage.getItem("user_yellowpass");if(preloadedState){var giftCard=JSON.parse(preloadedState);if(!!giftCard||Object.keys(giftCard).length>0){self.setState({loader:false})}self.setState(giftCard)}$.get(this.props.giftCardUrl).then(function(data){if(data.status){self.setState({giftCard:data.result});sessionStorage.setItem("user_yellowpass",JSON.stringify({giftCard:data.result}))}}).done(function(){self.setState({loader:false})})}},{key:"getCurrentDomain",value:function getCurrentDomain(){var hostParts=window.location.hostname.split(".");return hostParts[hostParts.length-2].capitalize()}},{key:"remainingPoints",value:function remainingPoints(){return this.state.giftCard.points_to_prize_confirmed}},{key:"collapseHistory",value:function collapseHistory(translation){var historyElement=$(".history");var recapElement=$(".recap");var closeShowButtonElement=$(".recap span:last-child");historyElement.slideToggle(500,function(){closeShowButtonElement.html(function(){if(historyElement.is(":visible")){recapElement.addClass("opened");return translation.chiudi+'&nbsp;<span class="icon icon-chevron-up" />'}recapElement.removeClass("opened");return translation.vediStorico+'&nbsp;<span class="icon icon-chevron-down" />'})})}},{key:"countValidPoints",value:function countValidPoints(){var count=0;this.state.giftCard.points_transactions.map(function(point){if(point.state==="confirmed"){count++}});return count}},{key:"render",value:function render(){var _this2=this;var giftcardDescription=this.props.translation.description.format(this.getCurrentDomain(),this.state.giftCard.points_for_prize);var giftcardRecap=this.remainingPoints()<=0?this.props.translation.pointsEarned:this.props.translation.recap.format(this.remainingPoints());var historyButtonClassNames=classNames({hidden:this.countValidPoints()===0});var giftcardClassNames=classNames({"user-giftcard":true,blur:this.state.loader});var isWidgetOnly=genericData.isWidgetOnly;return React.createElement("div",{className:giftcardClassNames},React.createElement("div",{className:"summary"},React.createElement("div",{className:"title"},this.props.translation.title),React.createElement("div",{className:"points"},React.createElement("span",{itemProp:"confirmed_points"},this.state.giftCard.confirmed_points),React.createElement("span",{itemProp:"points_for_prize"},this.state.giftCard.points_for_prize),React.createElement("span",{itemProp:"points_label"},this.props.translation.punti))),React.createElement("div",{className:"history"},isWidgetOnly?React.createElement("summary",null,giftcardDescription," ",React.createElement("strong",null,this.props.translation.comeFunziona)):React.createElement("summary",null,giftcardDescription," ",React.createElement("a",{href:this.props.translation.url},this.props.translation.comeFunziona)),React.createElement("ul",{className:"history-list"},this.state.giftCard.points_transactions.map(function(item,i){return React.createElement(YellowPassHistoryItem,{item:item,key:i})}))),React.createElement("div",{className:"recap"},isWidgetOnly?React.createElement("span",{className:"giftcard-recap"},React.createElement("span",{dangerouslySetInnerHTML:{__html:giftcardRecap}})," ",React.createElement("strong",null,this.props.translation.regalo),"!"):React.createElement("span",{className:"giftcard-recap"},React.createElement("span",{dangerouslySetInnerHTML:{__html:giftcardRecap}})," ",React.createElement("a",{href:this.props.translation.url},this.props.translation.regalo),"!"),React.createElement("span",{className:historyButtonClassNames,onClick:function onClick(){return _this2.collapseHistory(_this2.props.translation)}},this.props.translation.vediStorico," ",React.createElement("span",{className:"icon icon-chevron-down"}))))}}]);return YellowPass}(BaseComponent);YellowPass.propTypes={giftCard:React.PropTypes.object.isRequired,giftCardUrl:React.PropTypes.string.isRequired,translation:React.PropTypes.object.isRequired};var YellowPassHistoryItem=function(_React$Component){_inherits(YellowPassHistoryItem,_React$Component);function YellowPassHistoryItem(){var _ref;var _temp,_this3,_ret;_classCallCheck(this,YellowPassHistoryItem);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this3=_possibleConstructorReturn(this,(_ref=YellowPassHistoryItem.__proto__||Object.getPrototypeOf(YellowPassHistoryItem)).call.apply(_ref,[this].concat(args))),_this3),_this3.pointsLabel=function(){if(_this3.props.item.recharge){return Math.abs(_this3.props.item.points)}return-Math.abs(_this3.props.item.points)},_temp),_possibleConstructorReturn(_this3,_ret)}_createClass(YellowPassHistoryItem,[{key:"render",value:function render(){var pointsLabel=this.pointsLabel();var itemIconClasses=classNames({"history-item-icon":true,positive:pointsLabel>0,neutral:pointsLabel===0,negative:pointsLabel<0});if(this.props.item.state!=="confirmed"){return null}return React.createElement("li",null,React.createElement("div",{className:itemIconClasses},pointsLabel),React.createElement("div",{className:"history-item-detail"},React.createElement("span",null,moment(this.props.item.created_at).format("DD/MM/YYYY")),React.createElement("span",null,this.props.item.description),React.createElement("span",null,this.props.item.venue_name)))}}]);return YellowPassHistoryItem}(React.Component);
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FutureAppointmentContent=function(_React$Component){_inherits(FutureAppointmentContent,_React$Component);function FutureAppointmentContent(){var _ref;var _temp,_this,_ret;_classCallCheck(this,FutureAppointmentContent);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=FutureAppointmentContent.__proto__||Object.getPrototypeOf(FutureAppointmentContent)).call.apply(_ref,[this].concat(args))),_this),_this.getGenericTranslationString=function(string){return window&&window.genericTranslationData&&window.genericTranslationData.translation&&window.genericTranslationData.translation[string]||null},_this.minutesToTime=function(time_in_minutes){if(!time_in_minutes)return;var time_string="";var hours=Math.floor(time_in_minutes/60);var minutes=Math.floor(time_in_minutes-hours*3600/60);if(hours>0){time_string+=hours+" "+(_this.getGenericTranslationString("hoursExtendedLabel")||"h")}if(minutes>0){time_string=hours>0?time_string+" "+(_this.getGenericTranslationString("and")||":")+" ":time_string;time_string+=minutes+" "+(_this.getGenericTranslationString("minsExtendedLabel")||"m")}return time_string},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(FutureAppointmentContent,[{key:"render",value:function render(){var _props=this.props,_props$venue=_props.venue,venue=_props$venue===undefined?{}:_props$venue,_props$formattedTotal=_props.formattedTotal,formattedTotal=_props$formattedTotal===undefined?"0.00":_props$formattedTotal,_props$paidOnline=_props.paidOnline,paidOnline=_props$paidOnline===undefined?false:_props$paidOnline,_props$appointments=_props.appointments,appointments=_props$appointments===undefined?[]:_props$appointments,_props$location=_props.location,location=_props$location===undefined?{}:_props$location,_props$translation=_props.translation,translation=_props$translation===undefined?{}:_props$translation,isTreatmentsPresent=_props.isTreatmentsPresent,cancellationDelayMinutes=_props.cancellationDelayMinutes;var hostname=window.location.hostname.split(".")[1];var MapStyle={backgroundImage:"url(https://maps.a-cdn.net/static/"+hostname+"/?center="+location.latitude+","+location.longitude+"&zoom=14&size=640x120&maptype=roadmap&markers=anchor:center|scale:2|icon:https://cdn-images.uala.it/fe-images/map-marker-area-small.png|"+location.latitude+","+location.longitude+")",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"};var timeToCancelAppointments=this.minutesToTime(cancellationDelayMinutes);return React.createElement("div",{className:"detail"},React.createElement("div",{className:"treatments"},appointments.map(function(_ref2,index){var _ref2$treatmentName=_ref2.treatmentName,treatmentName=_ref2$treatmentName===undefined?"":_ref2$treatmentName,_ref2$staffMemberName=_ref2.staffMemberName,staffMemberName=_ref2$staffMemberName===undefined?"":_ref2$staffMemberName,_ref2$cherryPickedSta=_ref2.cherryPickedStaffMember,cherryPickedStaffMember=_ref2$cherryPickedSta===undefined?false:_ref2$cherryPickedSta,_ref2$price=_ref2.price,price=_ref2$price===undefined?0:_ref2$price,_ref2$discountedPrice=_ref2.discountedPrice,discountedPrice=_ref2$discountedPrice===undefined?0:_ref2$discountedPrice,_ref2$marketingPromot=_ref2.marketingPromotion,marketingPromotion=_ref2$marketingPromot===undefined?null:_ref2$marketingPromot,_ref2$originalPrice=_ref2.originalPrice,originalPrice=_ref2$originalPrice===undefined?0:_ref2$originalPrice,_ref2$discountAmount=_ref2.discountAmount,discountAmount=_ref2$discountAmount===undefined?0:_ref2$discountAmount;return React.createElement("div",{key:"treatment"+index,className:classNames({treatment:true,last:index===appointments.length-1})},React.createElement("span",{className:"name "+classNames({"with-dot-separator":cherryPickedStaffMember})},treatmentName),cherryPickedStaffMember?React.createElement("span",null,translation.with,React.createElement("span",{className:"staff"}," "+staffMemberName)):null,!isTreatmentsPresent?React.createElement("span",{className:classNames({price:true,promo:discountAmount>0})},React.createElement("label",null,marketingPromotion&&React.createElement("span",{className:"promo-badge"},translation.promo),discountAmount>0&&React.createElement("span",{className:"promo-price"}," - "+discountedPrice.toISOCurrency(domainData.default_locale,venue.currency_iso_code))),discountAmount>0&&React.createElement("label",null,React.createElement("span",{className:"promo-original-price"},translation.originalPrice),React.createElement("span",{className:"promo-original-price strike"},originalPrice.toISOCurrency(domainData.default_locale,venue.currency_iso_code))),discountAmount===0&&React.createElement("span",{className:"original-price"},originalPrice.toISOCurrency(domainData.default_locale,venue.currency_iso_code))):null)}),isTreatmentsPresent?React.createElement("div",{className:"summary"},React.createElement("span",{className:"paid-badge"},React.createElement("span",null,translation.treatmentsPresent))):React.createElement("div",{className:"summary"},paidOnline?React.createElement("span",{className:"paid-badge"},React.createElement("span",null,translation.paid)):React.createElement("span",null),React.createElement("span",{className:"total"},formattedTotal.toISOCurrency(domainData.default_locale,venue.currency_iso_code)))),React.createElement("div",{className:"location"},React.createElement("div",{className:"map",style:MapStyle}),React.createElement("a",{className:"button button-yellow button-circle button-shadow",href:location.urlDirections,target:"_blank",rel:"noopener"},React.createElement("i",{className:"icon icon-goto"})),React.createElement("div",{className:"venue-zone"},React.createElement("span",{dangerouslySetInnerHTML:{__html:location.formattedZone||""}})),React.createElement("div",{className:"venue-address"},location.formattedAddress)),React.createElement("div",{className:"info-note"},venue.phone&&React.createElement("span",null,translation.appointmentInfo.format(timeToCancelAppointments,timeToCancelAppointments)," ",translation.appointmentInfoPhone," ",React.createElement("a",{href:"tel:"+venue.phone},venue.phone)),!venue.phone&&venue.email&&React.createElement("span",null,translation.appointmentInfo.format(timeToCancelAppointments,timeToCancelAppointments)," ",translation.appointmentInfoEmail," ",React.createElement("a",{href:"mailto:"+venue.email},venue.email))))}}]);return FutureAppointmentContent}(React.Component);var PastAppointmentContent=function(_React$Component2){_inherits(PastAppointmentContent,_React$Component2);function PastAppointmentContent(){_classCallCheck(this,PastAppointmentContent);var _this2=_possibleConstructorReturn(this,(PastAppointmentContent.__proto__||Object.getPrototypeOf(PastAppointmentContent)).call(this));_this2.state={currentIndex:0,currentRating:0,appointments:[],validReview:false,loading:false};return _this2}_createClass(PastAppointmentContent,[{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.xhr)this.xhr.abort()}},{key:"submitRating",value:function submitRating(appointment_id,rating,index){var _this3=this;if(appointment_id&&rating){this.setState(_extends({},this.state,{loading:true}));var _props$onRatingSubmit=this.props.onRatingSubmit,onRatingSubmit=_props$onRatingSubmit===undefined?function(){return void 0}:_props$onRatingSubmit;this.xhr=$.post(profileData.rateUrl,{appointment_id:appointment_id,rating:rating});this.xhr.then(function(_ref3){var _ref3$success=_ref3.success,success=_ref3$success===undefined?false:_ref3$success;var extras={};if(success){var _state$currentIndex=_this3.state.currentIndex,currentIndex=_state$currentIndex===undefined?0:_state$currentIndex;extras={currentIndex:++currentIndex}}_this3.setState(_extends({},_this3.state,extras,{loading:false}));onRatingSubmit(index,appointment_id)})}}},{key:"checkReview",value:function checkReview(_ref4){var _ref4$target=_ref4.target,target=_ref4$target===undefined?{value:""}:_ref4$target;this.setState(_extends({},this.state,{review:target.value.trim()}))}},{key:"submitReview",value:function submitReview(booking_token){var _this4=this;var _state$review=this.state.review,review=_state$review===undefined?"":_state$review;var _props2=this.props,_props2$onReviewSubmi=_props2.onReviewSubmit,onReviewSubmit=_props2$onReviewSubmi===undefined?function(){return void 0}:_props2$onReviewSubmi,index=_props2.index;if(booking_token&&review.length){this.setState(_extends({},this.state,{loading:true}));this.xhr=$.post(profileData.reviewUrl,{booking_token:booking_token,body:review});this.xhr.then(function(_ref5){var success=_ref5.success;_this4.setState(_extends({},_this4.state,{loading:false}));if(success){onReviewSubmit(index)}})}}},{key:"render",value:function render(){var _this5=this;var _state=this.state,_state$currentRating=_state.currentRating,currentRating=_state$currentRating===undefined?0:_state$currentRating,_state$currentIndex2=_state.currentIndex,currentIndex=_state$currentIndex2===undefined?0:_state$currentIndex2,_state$review2=_state.review,review=_state$review2===undefined?"":_state$review2,_state$loading=_state.loading,loading=_state$loading===undefined?false:_state$loading;var _props3=this.props,_props3$appointments=_props3.appointments,appointments=_props3$appointments===undefined?[]:_props3$appointments,bookingToken=_props3.bookingToken,_props3$isReviewed=_props3.isReviewed,isReviewed=_props3$isReviewed===undefined?false:_props3$isReviewed,body=_props3.body;var unreviewedAppos=appointments.filter(function(_ref6){var rating=_ref6.rating;return typeof rating!=="number"});return React.createElement("div",{className:"detail"},React.createElement("div",null,isReviewed?this.props.translation.yourEvaluation:this.props.translation.rateYourExperience),!isReviewed&&currentIndex<unreviewedAppos.length?React.createElement("div",{className:"loader-container",style:{opacity:loading&&currentIndex<appointments.length-1?1:0}},React.createElement(CircularStepper,{size:30,strokeWidth:4,completion:100/3,animate:true})):null,isReviewed?React.createElement("div",{className:"review"},appointments.filter(function(_ref7){var rating=_ref7.rating;return typeof rating==="number"}).map(function(_ref8,index){var _ref8$treatmentName=_ref8.treatmentName,treatmentName=_ref8$treatmentName===undefined?"":_ref8$treatmentName,_ref8$staffMemberName=_ref8.staffMemberName,staffMemberName=_ref8$staffMemberName===undefined?"":_ref8$staffMemberName,rating=_ref8.rating,id=_ref8.id;return React.createElement("div",{className:"treatment",key:id},React.createElement("span",null,React.createElement("b",null,treatmentName),React.createElement("span",null," ",_this5.props.translation.with," ",staffMemberName)),React.createElement("span",{className:"stars"},[1,2,3,4,5].map(function(star){return React.createElement("i",{key:star,className:"\n                                                    icon\n                                                    icon-star-"+(rating>=star?"full":"full gray")+"\n                                                "})})))}),React.createElement("div",{className:"body"},React.createElement("div",{className:"quote"},"“"),React.createElement("div",{className:"message-review"},body))):React.createElement("div",{className:"rating"},React.createElement("div",{style:{transform:"translateX("+-100*currentIndex+"%)"}},unreviewedAppos.map(function(_ref9,index){var _ref9$treatmentName=_ref9.treatmentName,treatmentName=_ref9$treatmentName===undefined?"":_ref9$treatmentName,_ref9$staffMemberName=_ref9.staffMemberName,staffMemberName=_ref9$staffMemberName===undefined?"":_ref9$staffMemberName,_ref9$cherryPickedSta=_ref9.cherryPickedStaffMember,cherryPickedStaffMember=_ref9$cherryPickedSta===undefined?false:_ref9$cherryPickedSta,id=_ref9.id;return React.createElement("div",{key:index,className:"treatment"},React.createElement("div",{className:"info"},React.createElement("span",null,treatmentName)," ",cherryPickedStaffMember?_this5.props.translation.with+" "+staffMemberName:null),React.createElement("div",{className:"stars",onMouseLeave:function onMouseLeave(){return _this5.setState(_extends({},_this5.state,{currentRating:0}))}},[1,2,3,4,5].map(function(star){return React.createElement("i",{key:star,className:"\n                                                    icon\n                                                    icon-star-"+(currentRating>=star?"full":"full gray")+"\n                                                ",onMouseEnter:function onMouseEnter(){return _this5.setState(_extends({},_this5.state,{currentRating:star}))},onClick:function onClick(){return _this5.submitRating(id,star,index)}})})))}),React.createElement("div",{className:"textarea"},React.createElement("textarea",{placeholder:this.props.translation.reviewPlaceholder,onChange:function onChange(event){return _this5.checkReview(event)}}),React.createElement("div",{className:"button-loader-wrapper "+(loading?"loading":"")},React.createElement(CircularStepper,{size:60,strokeWidth:4,completion:100/3,animate:loading}),React.createElement("button",{className:"\n                                        button\n                                        button-circle\n                                        button-yellow\n                                        button-shadow\n                                        "+(review.length?"shown":"")+"\n                                        "+(loading?"loading":"")+"\n                                    ",onClick:function onClick(){return!loading?_this5.submitReview(bookingToken):null}},React.createElement("span",{className:"icon icon-send"}))))),React.createElement("div",{className:"dots"},unreviewedAppos.length>1&&currentIndex<unreviewedAppos.length?unreviewedAppos.map(function(appo,index){return React.createElement("div",{key:index,className:index===currentIndex?"current":""})}):null)))}}]);return PastAppointmentContent}(React.Component);var renderMap=function renderMap(latitude,longitude,ref){var venue=new google.maps.LatLng(latitude,longitude);var marker=void 0;var map=void 0;map=new google.maps.Map(ref,{zoom:14,zoomControl:true,center:venue,scrollwheel:false,draggable:false});var markerImage=new google.maps.MarkerImage("/images/map-marker-area.png",new google.maps.Size(220,220),new google.maps.Point(0,0),new google.maps.Point(110,110));marker=new google.maps.Marker({map:map,icon:markerImage,draggable:false,animation:google.maps.Animation.DROP,position:venue});map.setCenter(venue)};var AppointmentCancel=function(_React$Component3){_inherits(AppointmentCancel,_React$Component3);function AppointmentCancel(props){_classCallCheck(this,AppointmentCancel);var _this6=_possibleConstructorReturn(this,(AppointmentCancel.__proto__||Object.getPrototypeOf(AppointmentCancel)).call(this,props));_this6.lockAppointmentWhileDeleting=function(appointmentsUniqueId){$(document).on("DOMNodeInserted",function(e){if(e.target.id===appointmentsUniqueId){$("#"+appointmentsUniqueId).addClass("appointment-locked")}})};_this6.openProfileDrawer=function(){(new ModalHandler).hide();if(location.pathname.indexOf("dashboard")===-1){$("#user").click()}};_this6.state={isLoading:false};return _this6}_createClass(AppointmentCancel,[{key:"cancelAppointment",value:function cancelAppointment(){var _this7=this;var _props4=this.props,appointmentsUniqueId=_props4.appointmentsUniqueId,urlCancel=_props4.urlCancel,appointmentsIds=_props4.appointmentsIds,bookingToken=_props4.bookingToken,onCancelAppointments=_props4.onCancelAppointments;this.setState({isLoading:true});if(urlCancel&&appointmentsIds.length){Tracker.trackEvent("UArefund",{ecommerce:{refund:{actionField:{id:bookingToken}}}});$.post(urlCancel,{appointmentsIds:appointmentsIds,bookingToken:bookingToken}).then(function(_ref10){var success=_ref10.success;if(success){onCancelAppointments(appointmentsUniqueId);_this7.setState({isLoading:false});_this7.lockAppointmentWhileDeleting(appointmentsUniqueId);_this7.openProfileDrawer()}})}}},{key:"render",value:function render(){var _this8=this;var _props5=this.props,venue=_props5.venue,formattedDate=_props5.formattedDate,pricePaid=_props5.pricePaid,translation=_props5.translation;var isLoading=this.state.isLoading;return React.createElement("div",{className:"AppointmentCancel"},React.createElement("div",{className:"AppointmentCancel-header"},React.createElement("i",{className:"icon-extended icon-calendar-cross"})),React.createElement("h1",null,translation.title),React.createElement("div",{className:"AppointmentCancel-info"},React.createElement("div",{className:"AppointmentCancel-info-venue"},translation.venue.format(formattedDate,venue.name)),React.createElement("div",{className:"AppointmentCancel-info-wallet"},React.createElement(Wallet,{width:"52px",height:"52px"}),React.createElement("span",null,translation.wallet.format(pricePaid.toISOCurrency(domainData.default_locale,venue.currency_iso_code),window.location.hostname.split(".")[1].capitalize())))),React.createElement("div",{className:"AppointmentCancel-actions"},React.createElement("div",{className:"button clear",onClick:function onClick(){_this8.openProfileDrawer()}},translation.abort),React.createElement("div",{className:classNames({button:true,"button-red":true,disabled:isLoading}),onClick:function onClick(){return _this8.cancelAppointment()}},isLoading?React.createElement(LoaderComponent,null):translation.unsubscribe)))}}]);return AppointmentCancel}(React.Component);var AppointmentCard=function(_React$Component4){_inherits(AppointmentCard,_React$Component4);function AppointmentCard(props){_classCallCheck(this,AppointmentCard);var _this9=_possibleConstructorReturn(this,(AppointmentCard.__proto__||Object.getPrototypeOf(AppointmentCard)).call(this,props));_this9.state={loadingCancel:false};return _this9}_createClass(AppointmentCard,[{key:"handleCancel",value:function handleCancel(appointmentsUniqueId,urlCancel){var appointmentsIds=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var _this10=this;var bookingToken=arguments[3];var paidOnline=arguments[4];if(paidOnline){(new ModalHandler).show(React.createElement(AppointmentCancel,_extends({},this.props,{appointmentsUniqueId:appointmentsUniqueId,urlCancel:urlCancel,appointmentsIds:appointmentsIds,bookingToken:bookingToken,onCancelAppointments:this.props.cancelAppointments,translation:this.props.translation.cancelModal})),{width:365,height:"auto"});return true}if(urlCancel&&appointmentsIds.length){this.setState(_extends({},this.state,{loadingCancel:true}));Tracker.trackEvent("UArefund",{ecommerce:{refund:{actionField:{id:bookingToken}}}});$.post(urlCancel,{appointmentsIds:appointmentsIds,bookingToken:bookingToken}).then(function(_ref11){var success=_ref11.success;if(success){_this10.setState(_extends({},_this10.state,{showOverlay:true,loadingCancel:false}));_this10.props.cancelAppointments(appointmentsUniqueId)}})}}},{key:"handleReviewMessage",value:function handleReviewMessage(){var _this11=this;this.setState(_extends({},this.state,{showOverlay:true}));window.setTimeout(function(){return _this11.props.fetchData()},500);window.setTimeout(function(){return _this11.state.showOverlay=false},3e3)}},{key:"toggleSocialActions",value:function toggleSocialActions(flag){this.setState(_extends({},this.state,{showSocialActions:typeof flag==="boolean"?flag:!this.state.showSocialActions}))}},{key:"render",value:function render(){var _this12=this;var _props6=this.props,_props6$translation=_props6.translation,translation=_props6$translation===undefined?{}:_props6$translation,_props6$past=_props6.past,past=_props6$past===undefined?false:_props6$past,_props6$dateStart=_props6.dateStart,dateStart=_props6$dateStart===undefined?0:_props6$dateStart,_props6$venue=_props6.venue,venue=_props6$venue===undefined?{}:_props6$venue,_props6$appointments=_props6.appointments,appointments=_props6$appointments===undefined?[]:_props6$appointments,_props6$paidOnline=_props6.paidOnline,paidOnline=_props6$paidOnline===undefined?false:_props6$paidOnline,_props6$cancellationD=_props6.cancellationDelayMinutes,cancellationDelayMinutes=_props6$cancellationD===undefined?0:_props6$cancellationD,_props6$cancelable=_props6.cancelable,cancelable=_props6$cancelable===undefined?false:_props6$cancelable,_props6$urlCancel=_props6.urlCancel,urlCancel=_props6$urlCancel===undefined?"":_props6$urlCancel,_props6$urlRebook=_props6.urlRebook,urlRebook=_props6$urlRebook===undefined?"":_props6$urlRebook,index=_props6.index,bookingToken=_props6.bookingToken,_props6$isReviewed=_props6.isReviewed,isReviewed=_props6$isReviewed===undefined?false:_props6$isReviewed,_props6$review=_props6.review,review=_props6$review===undefined?"":_props6$review,onRatingSubmit=_props6.onRatingSubmit,formattedDate=_props6.formattedDate,formattedStartTime=_props6.formattedStartTime,formattedEndTime=_props6.formattedEndTime,_props6$isTreatmentsP=_props6.isTreatmentsPresent,isTreatmentsPresent=_props6$isTreatmentsP===undefined?false:_props6$isTreatmentsP;var _state2=this.state,_state2$loadingCancel=_state2.loadingCancel,loadingCancel=_state2$loadingCancel===undefined?false:_state2$loadingCancel,_state2$showOverlay=_state2.showOverlay,showOverlay=_state2$showOverlay===undefined?false:_state2$showOverlay,_state2$showSocialAct=_state2.showSocialActions,showSocialActions=_state2$showSocialAct===undefined?false:_state2$showSocialAct;var forwardedProps={};var _venue$name=venue.name,name=_venue$name===undefined?"":_venue$name,_venue$url=venue.url,url=_venue$url===undefined?"":_venue$url,_venue$phone=venue.phone,phone=_venue$phone===undefined?"":_venue$phone,_venue$averageRating=venue.averageRating,averageRating=_venue$averageRating===undefined?0:_venue$averageRating,_venue$reviewsCount=venue.reviewsCount,reviewsCount=_venue$reviewsCount===undefined?0:_venue$reviewsCount,_venue$latitude=venue.latitude,latitude=_venue$latitude===undefined?0:_venue$latitude,_venue$longitude=venue.longitude,longitude=_venue$longitude===undefined?0:_venue$longitude,_venue$formattedZone=venue.formattedZone,formattedZone=_venue$formattedZone===undefined?"":_venue$formattedZone,_venue$formattedAddre=venue.formattedAddress,formattedAddress=_venue$formattedAddre===undefined?"":_venue$formattedAddre,_venue$urlDirections=venue.urlDirections,urlDirections=_venue$urlDirections===undefined?"":_venue$urlDirections,_venue$urlVanity=venue.urlVanity,urlVanity=_venue$urlVanity===undefined?"":_venue$urlVanity,_venue$bookByPhone=venue.bookByPhone,bookByPhone=_venue$bookByPhone===undefined?false:_venue$bookByPhone;var formattedTotal=appointments.reduce(function(sum,_ref12){var _ref12$paidOnlineAmou=_ref12.paidOnlineAmount,paidOnlineAmount=_ref12$paidOnlineAmou===undefined?0:_ref12$paidOnlineAmou,_ref12$originalPrice=_ref12.originalPrice,originalPrice=_ref12$originalPrice===undefined?0:_ref12$originalPrice,_ref12$discountedPric=_ref12.discountedPrice,discountedPrice=_ref12$discountedPric===undefined?0:_ref12$discountedPric;return paidOnline?sum+paidOnlineAmount:sum+discountedPrice},0);var countDown="";var isUrgent=false;if(past){forwardedProps=_extends({index:index,appointments:appointments,isTreatmentsPresent:isTreatmentsPresent,translation:translation,bookingToken:bookingToken,isReviewed:isReviewed,onReviewSubmit:this.handleReviewMessage.bind(this),onRatingSubmit:onRatingSubmit},review)}else{forwardedProps={venue:venue,formattedTotal:formattedTotal,paidOnline:paidOnline,appointments:appointments,isTreatmentsPresent:isTreatmentsPresent,cancellationDelayMinutes:cancellationDelayMinutes,translation:translation,location:{latitude:latitude,longitude:longitude,formattedZone:formattedZone,formattedAddress:formattedAddress,urlDirections:urlDirections}};if(formattedStartTime&&formattedEndTime){var _currentDate=moment();var _date=moment.unix(dateStart);var duration=moment.duration(_date.diff(_currentDate));var differenceDays=parseInt(duration.asDays());var differenceHours=parseInt(duration.asHours());var differenceMinutes=parseInt(duration.asMinutes())%60;var incoming=_date.isAfter();if(incoming){if(_date.isSame(_currentDate,"date")){if(differenceHours<=5){isUrgent=true;countDown=differenceHours+":"+(differenceMinutes<10?"0"+differenceMinutes:differenceMinutes)+"h"}else{isUrgent=true;countDown=this.props.translation.today}}else if(differenceDays===0){countDown=""+this.props.translation.tomorrow}else{countDown=this.props.translation.within+" "+differenceDays+" "+(differenceDays>1?this.props.translation.days:this.props.translation.day)}}}}var isAppointment=!!appointments.find(function(a){return a.isAppointment});var isEntranceTicket=!!appointments.find(function(a){return a.isEntranceTicket});var isCancelable=cancelable&&moment().add(cancellationDelayMinutes,"minutes").isBefore(moment.unix(dateStart));var appointmentsUniqueId=bookingToken;return React.createElement("div",{id:appointmentsUniqueId,className:"\n                profile-card\n                "+(past?"past":"future")+"\n                "+(isUrgent?"urgent":"")+"\n            "},!past?React.createElement("div",{className:"badge"},countDown):null,React.createElement("div",{className:"summary"},React.createElement("div",{className:classNames({date:true,appointment:isAppointment,"entrance-ticket":isEntranceTicket})},React.createElement("span",{className:"day"},formattedDate),isAppointment&&React.createElement("span",{className:"hour start"},formattedStartTime),isAppointment&&React.createElement("span",{className:"hour finish"},"- ",formattedEndTime),isEntranceTicket&&React.createElement("span",{className:"hour start"},this.props.translation.fromHour.format(formattedStartTime)),past?React.createElement("span",{className:"paid-badge"},React.createElement("span",null,paidOnline?this.props.translation.paid:this.props.translation.paidOnSalon)):null),React.createElement("div",{className:"venue-name"},React.createElement("a",{href:genericData.isWidgetOnly?url+"/widget":url},name),past&&!isTreatmentsPresent?React.createElement("span",{className:"total"},"€",formattedTotal):null),React.createElement("div",{className:"venue-rating"},React.createElement("span",{className:"stars"},[1,2,3,4,5].map(function(star){var full=Math.round(averageRating||0)>=star;return React.createElement("span",{key:"star"+star,className:"\n                                            icon active\n                                            icon-star-"+(full?"full":"empty")+"\n                                        "})})),React.createElement("span",{className:"reviews"}," ",reviewsCount||0," ",this.props.translation.review))),past?React.createElement(PastAppointmentContent,forwardedProps):React.createElement(FutureAppointmentContent,forwardedProps),React.createElement("div",{className:"\n                    actions\n                    "+(showSocialActions?"show-social":"")+"\n                "},React.createElement("div",{className:"base"},phone?React.createElement("a",{className:"call",href:"tel:"+phone},React.createElement("i",{className:"icon icon-phone"}),React.createElement("span",null,this.props.translation.call)):null,past&&!bookByPhone?React.createElement("a",{className:"book-again",href:urlRebook+"#booking=0"},React.createElement("span",null,this.props.translation.rebook)):React.createElement("span",null),isCancelable?React.createElement("span",{className:"edit",onClick:function onClick(){return window.open(url+"?appointment="+bookingToken,"_self")}},React.createElement("span",null,this.props.translation.edit)):null,isCancelable?React.createElement("span",{className:"cancel",onClick:function onClick(){return _this12.handleCancel(appointmentsUniqueId,urlCancel,appointments.map(function(_ref13){var id=_ref13.id;return id}),bookingToken,paidOnline)}},loadingCancel?React.createElement(CircularStepper,{size:30,strokeWidth:4,completion:100/3,animate:true}):React.createElement("span",null,this.props.translation.unsubscribe.toUpperCase())):null),past?React.createElement("div",{className:"social"},React.createElement(SocialActions,{venueName:name,venueAddress:formattedAddress,venueUrl:urlVanity,translation:this.props.translation}),React.createElement("span",{className:"close",onClick:function onClick(){return _this12.toggleSocialActions(false)}},React.createElement("i",{className:"icon icon-close"}))):null),showOverlay?React.createElement(CardOverlay,{icon:past?"icon-check":"icon-close",type:past?null:"warn"},React.createElement("div",null,past?React.createElement("span",null,this.props.translation.thankyou," ",(profileData.fullName||"").split(" ",1)[0],","," ",this.props.translation.reviewPublished):React.createElement("span",{className:"delete-appointment"},this.props.translation.bookUnsubscribed1," ",React.createElement("b",null,name)," ",this.props.translation.bookUnsubscribed2,paidOnline?React.createElement("p",null,this.props.translation.bookUnsubscribedPaidOnline1,React.createElement("br",null),this.props.translation.bookUnsubscribedPaidOnline2):null))):null)}}]);return AppointmentCard}(React.Component);var CardOverlay=function CardOverlay(_ref14){var _ref14$icon=_ref14.icon,icon=_ref14$icon===undefined?"":_ref14$icon,_ref14$message=_ref14.message,message=_ref14$message===undefined?"":_ref14$message,children=_ref14.children,_ref14$type=_ref14.type,type=_ref14$type===undefined?"":_ref14$type;return React.createElement("div",{className:"overlay"},React.createElement("div",{className:"icon-container"},React.createElement("i",{className:"icon "+icon+" "+type})),React.createElement("div",{className:"content"},children))};var UserAppointments=function(_React$Component5){_inherits(UserAppointments,_React$Component5);function UserAppointments(props){_classCallCheck(this,UserAppointments);var _this13=_possibleConstructorReturn(this,(UserAppointments.__proto__||Object.getPrototypeOf(UserAppointments)).call(this,props));_this13.state={page:1,future:[],past:[],loader:true,load_more_loader:false,giftCard:profileData.giftCard,giftCardUrl:profileData.giftCardUrl};return _this13}_createClass(UserAppointments,[{key:"cancelAppointments",value:function cancelAppointments(elementId){var self=this;this.xhr=$.post(profileData.appointmentsUrl);this.xhr.then(function(_ref15){
var _ref15$future=_ref15.future,future=_ref15$future===undefined?[]:_ref15$future,_ref15$past=_ref15.past,past=_ref15$past===undefined?[]:_ref15$past,_ref15$today=_ref15.today,today=_ref15$today===undefined?[]:_ref15$today;$("#"+elementId).fadeTo(1e3,0,function(){$(this).slideUp(1e3,function(){self._updateAppointments({future:[].concat(_toConsumableArray(today),_toConsumableArray(future)),past:past})})})});return this.xhr}},{key:"componentDidMount",value:function componentDidMount(){this.fetchData()}},{key:"componentWillUnmount",value:function componentWillUnmount(){var page=this.state.page;if(this.xhr){if(page>1){this.setState({page:page-1})}this.xhr.abort()}}},{key:"fetchData",value:function fetchData(){var _this14=this;var page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;try{var preloadedState=sessionStorage.getItem("user_appointments");if(preloadedState){var appointments=JSON.parse(preloadedState);if(appointments.future.length>0||appointments.past.length>0){this.setState({loader:false})}this.setState(appointments)}}catch(e){console.log(e)}this.xhr=$.post(profileData.appointmentsUrl,{page:page});this.xhr.then(function(_ref16){var _ref16$future=_ref16.future,future=_ref16$future===undefined?[]:_ref16$future,_ref16$past=_ref16.past,past=_ref16$past===undefined?[]:_ref16$past,_ref16$today=_ref16.today,today=_ref16$today===undefined?[]:_ref16$today;_this14._updateAppointments({future:[].concat(_toConsumableArray(today),_toConsumableArray(future)),past:past})});return this.xhr}},{key:"_updateAppointments",value:function _updateAppointments(state){this.setState(state);sessionStorage.setItem("user_appointments",JSON.stringify(state));this.removeLoader();return state}},{key:"saveRatingLocally",value:function saveRatingLocally(appointmentIndex,appointmentId){var _state3=_extends({},this.state),_state3$past=_state3.past,past=_state3$past===undefined?[]:_state3$past;var result=past.map(function(appo,index){if(index!==appointmentIndex)return appo;else{var appointments=appo.appointments.filter(function(_ref17){var id=_ref17.id,isReviewed=_ref17.isReviewed;return appointmentId!==id&&!isReviewed});return _extends({},appo,{appointments:appointments})}});sessionStorage.setItem("user_appointments",JSON.stringify(_extends({},this.state,{past:result})))}},{key:"removeLoader",value:function removeLoader(){this.setState({loader:false})}},{key:"handleLoadMore",value:function handleLoadMore(){var _this15=this;var page=this.state.page;var nextPage=page+1;this.setState({page:nextPage,load_more_loader:true},function(){_this15.xhr=$.post(profileData.appointmentsUrl,{page:nextPage});_this15.xhr.then(function(_ref18){var past=_ref18.past;if(past.length>0){_this15._updateAppointments({past:[].concat(_toConsumableArray(_this15.state.past),_toConsumableArray(past)),load_more_loader:false})}else{_this15.setState({page:-1})}})})}},{key:"render",value:function render(){var _this16=this;var _state4=this.state,page=_state4.page,loader=_state4.loader,load_more_loader=_state4.load_more_loader,_state4$future=_state4.future,future=_state4$future===undefined?[]:_state4$future,_state4$past=_state4.past,past=_state4$past===undefined?[]:_state4$past;var appointmentsClassNames=classNames({blur:loader,"user-appointments":true});return React.createElement("div",{className:"user-appointments-tab"},this.state.giftCard?React.createElement(YellowPass,{giftCard:this.state.giftCard,giftCardUrl:this.state.giftCardUrl,translation:this.props.translation.giftCard}):null,loader?React.createElement(LoaderComponent,null):null,React.createElement("div",{className:appointmentsClassNames},future.length?React.createElement("div",{className:"label"},this.props.translation.futureAppointments):null,future.map(function(){var appointment=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var index=arguments[1];return React.createElement(AppointmentCard,_extends({key:index,index:index,fetchData:_this16.fetchData.bind(_this16),cancelAppointments:_this16.cancelAppointments.bind(_this16),translation:_this16.props.translation},appointment))}),past.length>0?React.createElement("div",{className:"label"},this.props.translation.pastAppointments):null,past.map(function(){var appointment=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var index=arguments[1];return React.createElement(AppointmentCard,_extends({past:true,key:index,index:index,fetchData:_this16.fetchData.bind(_this16),onRatingSubmit:_this16.saveRatingLocally.bind(_this16),translation:_this16.props.translation},appointment))}),past.length>0&&page>0?React.createElement("div",{className:"load-more-wrapper"},load_more_loader?React.createElement(LoaderComponent,null):React.createElement("div",{className:"button",onClick:this.handleLoadMore.bind(this)},this.props.translation.loadMore)):React.createElement("div",{className:"load-more-wrapper"},React.createElement("div",{className:"no-content"},this.props.translation.noContent))))}}]);return UserAppointments}(React.Component);
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UserFavorites=function(_React$Component){_inherits(UserFavorites,_React$Component);function UserFavorites(){_classCallCheck(this,UserFavorites);var _this=_possibleConstructorReturn(this,(UserFavorites.__proto__||Object.getPrototypeOf(UserFavorites)).call(this));_this.state={venues:[],loader:true};return _this}_createClass(UserFavorites,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var preloadedState=sessionStorage.getItem("user_favorites");if(preloadedState){var favorites=JSON.parse(preloadedState);if(favorites.venues.length>0){this.setState({loader:false})}this.setState(favorites)}this.xhr=$.post(profileData.favoritesUrl);this.xhr.then(function(_ref){var _ref$venues=_ref.venues,venues=_ref$venues===undefined?[]:_ref$venues;_this2.setState({venues:venues});sessionStorage.setItem("user_favorites",JSON.stringify({venues:venues}));_this2.removeLoader()})}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.xhr)this.xhr.abort()}},{key:"removeLoader",value:function removeLoader(){this.setState({loader:false})}},{key:"render",value:function render(){var _this3=this;var Loader=this.state.loader?React.createElement(LoaderComponent,null):"";return React.createElement("div",{className:"user-favorites"},Loader,this.state.venues.map(function(venue,index){return React.createElement(FavoriteCard,_extends({key:index},venue,{translation:_this3.props.translation}))}))}}]);return UserFavorites}(React.Component);var FavoriteCard=function FavoriteCard(_ref2){var _ref2$name=_ref2.name,name=_ref2$name===undefined?"":_ref2$name,_ref2$thumbImageUrl=_ref2.thumbImageUrl,thumbImageUrl=_ref2$thumbImageUrl===undefined?"":_ref2$thumbImageUrl,_ref2$averageRating=_ref2.averageRating,averageRating=_ref2$averageRating===undefined?0:_ref2$averageRating,_ref2$reviewsCount=_ref2.reviewsCount,reviewsCount=_ref2$reviewsCount===undefined?0:_ref2$reviewsCount,_ref2$formattedZone=_ref2.formattedZone,formattedZone=_ref2$formattedZone===undefined?"":_ref2$formattedZone,_ref2$formattedAddres=_ref2.formattedAddress,formattedAddress=_ref2$formattedAddres===undefined?"":_ref2$formattedAddres,_ref2$bookings=_ref2.bookings,bookings=_ref2$bookings===undefined?0:_ref2$bookings,_ref2$people=_ref2.people,people=_ref2$people===undefined?[]:_ref2$people,urlToggleFavourite=_ref2.urlToggleFavourite,_ref2$bookByPhone=_ref2.bookByPhone,bookByPhone=_ref2$bookByPhone===undefined?false:_ref2$bookByPhone,_ref2$url=_ref2.url,url=_ref2$url===undefined?"":_ref2$url,_ref2$urlVanity=_ref2.urlVanity,urlVanity=_ref2$urlVanity===undefined?"":_ref2$urlVanity,_ref2$translation=_ref2.translation,translation=_ref2$translation===undefined?{}:_ref2$translation;return React.createElement("div",{className:"profile-card"},React.createElement("div",{className:"summary"},React.createElement("div",{className:"venue-image",style:{backgroundImage:"url('"+thumbImageUrl+"')"}}),React.createElement("div",{className:"venue-info"},React.createElement("div",{className:"venue-name"},React.createElement("a",{href:genericData.isWidgetOnly?url+"/widget":url},name)),React.createElement("div",{className:"venue-rating"},React.createElement("span",{className:"stars"},[1,2,3,4,5].map(function(star){var full=Math.round(averageRating)>=star;return React.createElement("span",{key:"star"+star,className:"\n                                        icon active\n                                        icon-star-"+(full?"full":"empty")+"\n                                    "})})),React.createElement("span",{className:"reviews"}," ",reviewsCount," ",translation.reviews)),React.createElement("div",{className:"venue-zone"},React.createElement("span",{dangerouslySetInnerHTML:{__html:formattedZone}})),React.createElement("div",{className:"venue-address"},formattedAddress))),React.createElement("div",{className:"content"},React.createElement("div",{className:"actions"},React.createElement(Heart,{url:urlToggleFavourite,userIsLogged:true,active:true,button:true,translation:translation}),url===null||bookByPhone===true?null:React.createElement("a",{className:"button button-yellow book",href:url+"#booking=0"},React.createElement("span",null,translation.book))),people.length>0?React.createElement("div",{className:"people"},React.createElement("div",{className:"profile-pictures"},people.map(function(_ref3,index){var profilePicture=_ref3.profilePicture;return React.createElement("div",{key:index,className:index<1?"first":"other",style:{backgroundImage:"url('"+profilePicture+"')",zIndex:people.length-index}})})),React.createElement("span",null,React.createElement("span",null,people[0].name)," ",translation.other1," ",bookings.toLocaleString()," ",translation.other2)):null),React.createElement("div",{className:"actions"},React.createElement("div",{className:"base"},React.createElement(SocialActions,{venueName:name,venueAddress:formattedAddress,venueUrl:urlVanity,translation:translation}))))};
"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MINI_GIFTCARD_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/mini-giftcard.png";var MINI_GIFTCARD_FR_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/mini-giftcard-fr.png";var DEFAULT_VENUE_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/venue/default-thumb.jpg";var CONVERTED_CREDIT_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/conv-cred.png";var OPERATOR_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/operator.jpg";var getGenericErrorLabel=function getGenericErrorLabel(){return genericTranslationData&&genericTranslationData.translation&&genericTranslationData.translation.notice&&genericTranslationData.translation.notice.apiGenericError||"Error"};var ProfileWallet=function(_React$Component){_inherits(ProfileWallet,_React$Component);function ProfileWallet(props){_classCallCheck(this,ProfileWallet);var _this=_possibleConstructorReturn(this,(ProfileWallet.__proto__||Object.getPrototypeOf(ProfileWallet)).call(this,props));_this.componentDidMount=function(){var preloadedState=sessionStorage.getItem("user_wallet");if(preloadedState){var wallet=JSON.parse(preloadedState);_this.setState(wallet)}_this.fetchWallet()};_this.componentWillUnmount=function(){if(_this.xhr)_this.xhr.abort()};_this.fetchWallet=function(){_this.xhr=$.post("/api/profile/wallet",{auth_token:interactiveSignData.user.auth_token});_this.xhr.then(function(response){if(response.success){_this.setState({wallet:response.data});sessionStorage.setItem("user_wallet",JSON.stringify({wallet:response.data}))}if(!response.success){Notice.danger(getGenericErrorLabel())}})};_this.getWalletTypology=function(wallet){switch(wallet.description){case"Treatment Present Conversion":return"converted_credit";case"Gift Card":return"giftcard";case"Recharge by operator":return"recharge_by_operator";case"Payment by operator":return"payment_by_operator";default:return null}};_this.getFirstInExpiration=function(wallet){if(wallet&&Object.keys(wallet.histories).length>0){var today=moment();var recharges=[];Object.keys(wallet.histories).forEach(function(h){wallet.histories[h].forEach(function(x){if(x.type==="recharges"&&moment(x.valid_to).isAfter(today)){recharges.push(x)}})});return recharges.sort(function(a,b){return a.valid_to-b.valid_to}).find(function(r){return!!r})}return null};_this.state={wallet:null,showInfo:false};return _this}_createClass(ProfileWallet,[{key:"render",value:function render(){var _this2=this;var translation=this.props.translation;var _state=this.state,wallet=_state.wallet,showInfo=_state.showInfo;var total_amount=wallet&&wallet.residual_amount_cents?wallet.residual_amount_cents/100:0;var first_in_expiration=this.getFirstInExpiration(wallet);return React.createElement("div",{className:"ProfileWallet"},React.createElement("div",{className:"overview"},React.createElement(Wallet,{color:"#939999"}),React.createElement("div",{className:"amount-wrapper"},React.createElement("label",null,translation.wallet.title),React.createElement("div",{className:"amount"},total_amount.toCurrency(domainData.default_locale)),first_in_expiration&&React.createElement("div",{className:classNames({expiring:true,"show-info":showInfo})},React.createElement("span",null,translation.wallet.expirationLabel.format((first_in_expiration.amount_cents/100).toCurrency(domainData.default_locale),moment(first_in_expiration.valid_to).locale(domainData.default_locale).format("DD MMMM YYYY"))),React.createElement("span",{onClick:function onClick(){return _this2.setState({showInfo:true})}},translation.wallet.expirationLink),React.createElement("label",null,React.createElement("h3",null,translation.wallet.expirationPopupTitle),React.createElement("i",{className:"icon icon-close",onClick:function onClick(){return _this2.setState({showInfo:false})}}),React.createElement("article",null,translation.wallet.expirationPopupContent))))),!wallet&&React.createElement(LoaderComponent,null),wallet&&Object.keys(wallet.histories).length>0&&React.createElement("div",{className:"logs"},React.createElement("div",{className:"periods"},Object.keys(wallet.histories).sort(function(a,b){return a>b?-1:a<b?1:0}).map(function(key,i){var period=wallet.histories[key];return React.createElement("span",{key:i},React.createElement("label",null,moment(key,"YYYYMM").locale(domainData.default_locale).format("MMMM")),period.sort(function(a,b){return a.created_at>b.created_at?-1:a.created_at<b.created_at?1:0}).map(function(item,x){var amount=item.amount_cents/100;return React.createElement("div",{key:x,className:"period"},item.recharge?React.createElement("img",{src:item.description==="Gift Card"?MINI_GIFTCARD_IMAGE_PATH:CONVERTED_CREDIT_IMAGE_PATH,alt:item.description==="Gift Card"?item.description:translation.wallet.converted}):React.createElement("img",{src:item.venue_image||DEFAULT_VENUE_IMAGE_PATH,alt:item.venue_name||"Venue"}),React.createElement("div",{className:"info"},React.createElement("div",{className:"info-group"},React.createElement("span",{className:"service-name"},item.recharge?translation.wallet[_this2.getWalletTypology(item)]||item.description:item.venue_name||"Venue"),React.createElement("span",null,moment(item.created_at).format("DD/MM/YYYY"))),React.createElement("div",{className:"info-group"},React.createElement("div",{className:"price-group"},React.createElement("span",{className:"amount"},item.recharge?"+ "+amount.toCurrency(domainData.default_locale):"- "+amount.toCurrency(domainData.default_locale)),item.valid_to&&React.createElement("span",{className:"valid-to"},"("+translation.wallet.validTo.format(moment(item.valid_to).format("DD/MM/YYYY"))+")")),React.createElement("span",{className:"state "+(item.recharge?"positive":"negative")}))))}))}))))}}]);return ProfileWallet}(React.Component);
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var GIFTCARD_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/giftcard/giftcard.jpg";var YELLOWPASS_IMAGE_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/yellow-pass.png";var DISABLED_OVERLAY_PATH="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/view/static/giftcard-advanced/disabled-overlay.svg";var VENUE_DEFAULT_THUMB="https://production-hairdressr.s3-eu-west-1.amazonaws.com/fe-images/venue/default-thumb.jpg";var getGenericErrorLabel=function getGenericErrorLabel(){return genericTranslationData&&genericTranslationData.translation&&genericTranslationData.translation.notice&&genericTranslationData.translation.notice.apiGenericError||"Error"};var ProfileCoupons=function(_BaseComponent){_inherits(ProfileCoupons,_BaseComponent);function ProfileCoupons(props){_classCallCheck(this,ProfileCoupons);var _this=_possibleConstructorReturn(this,(ProfileCoupons.__proto__||Object.getPrototypeOf(ProfileCoupons)).call(this,props));_this.isMobile=function(){return window.innerWidth<640};_this.fetchUserPromotions=function(){_this.xhr=$.post("/api/promotions/user-promotions",{auth_token:interactiveSignData.user.auth_token});_this.xhr.then(function(response){if(response.success){_this.setState({isLoading:false,marketing_promotions:response.marketing_promotions});sessionStorage.setItem("user_promotions",JSON.stringify({marketing_promotions:response.marketing_promotions}))}if(!response.success){Notice.danger(getGenericErrorLabel())}})};_this.onClickTab=function(active_tab){var tabs=_this.state.tabs;_this.setState({tabs:tabs.map(function(tab){tab.active=tab.key===active_tab.key;return tab})})};_this.onChangeTab=function(e){var tabs=_this.state.tabs;_this.setState({tabs:tabs.map(function(tab){tab.active=tab.key===e.target.value;return tab})})};_this.getCouponImage=function(coupon_name){var gifcardImagePath=_this.props.gifcardImagePath;switch(coupon_name){case"Gift Card":return gifcardImagePath;case"Yellow Pass":return YELLOWPASS_IMAGE_PATH;default:return GIFTCARD_IMAGE_PATH}};_this.activateCode=function(){var _this$state=_this.state,isCouponActivationLoading=_this$state.isCouponActivationLoading,coupon_code=_this$state.coupon_code;if(!coupon_code)return;if(isCouponActivationLoading)return;_this.setState({isCouponActivationLoading:true});var auth_token=interactiveSignData.user.auth_token;Promise.all([_this.redeemGiftCard({auth_token:auth_token}),_this.redeemTreatmentsPresent({auth_token:auth_token})]).then(function(responses){var redeem_result=null;for(var i=0;i<responses.length;i++){if(responses[i].code!==200){continue}redeem_result=responses[i].body||null}_this.setState({coupon_code:redeem_result?redeem_result.code:null,isCouponActivationLoading:false});if(redeem_result){window.location.href="/gift-activation?gift_id="+redeem_result.id}if(!redeem_result){Notice&&Notice.danger(_this.props.translation.activateCoupon.codeNotValid,".ProfileCoupons__Content-ActivateCoupon")}})};_this.redeemGiftCard=function(_ref){var auth_token=_ref.auth_token;var coupon_code=_this.state.coupon_code;return $.ajax({method:"POST",url:"/api/promotions/marketing-promotions-redeem",headers:{"X-Requested-With":"XMLHttpRequest"},data:{auth_token:auth_token,code:coupon_code}})};_this.redeemTreatmentsPresent=function(_ref2){var auth_token=_ref2.auth_token;var coupon_code=_this.state.coupon_code;return $.ajax({method:"POST",url:"/api/account/activation",headers:{"X-Requested-With":"XMLHttpRequest"},data:{auth_token:auth_token,code:coupon_code}})};_this.state={isLoading:true,isMobile:_this.isMobile(),isCouponActivationLoading:false,coupon_code:null,marketing_promotions:null,tabs:[{key:"gift-card",name:props.translation.coupons.giftCard,active:true},{key:"treatments-present",name:props.translation.coupons.treatmentsPresent,active:false},{key:"subscriptions",name:props.translation.coupons.subscriptions,active:false},{key:"vip-card",name:props.translation.coupons.vipCard,active:false}]};return _this}_createClass(ProfileCoupons,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var preloadedState=sessionStorage.getItem("user_promotions");if(preloadedState){var promotions=JSON.parse(preloadedState);if(!!promotions){this.setState({isLoading:false})}this.setState(promotions)}this.fetchUserPromotions();window.addEventListener("resize",this.onWindowResize=function(){_this2.setState({isMobile:_this2.isMobile()})})}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.xhr)this.xhr.abort();window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function render(){var _this3=this;var _props=this.props,translation=_props.translation,gifcardImagePath=_props.gifcardImagePath;var _state=this.state,isMobile=_state.isMobile,isLoading=_state.isLoading,isCouponActivationLoading=_state.isCouponActivationLoading,tabs=_state.tabs,marketing_promotions=_state.marketing_promotions,coupon_code=_state.coupon_code;var active_tab=tabs.find(function(t){return t.active}).key;var has_extra_axtion=active_tab==="gift-card"||active_tab==="treatments-present";return React.createElement("div",{className:"ProfileCoupons__Wrapper"},React.createElement("div",{className:"ProfileCoupons__Content-ExtraActions"},has_extra_axtion&&React.createElement("div",{className:"ProfileCoupons__Content-ActivateCoupon"},React.createElement("div",{className:"ProfileCoupons__Content-ActivateCoupon-title"},React.createElement("i",{className:"icon-extended icon-gift-package"}),React.createElement("span",null,translation.activateCoupon.haveCode)),React.createElement("div",{className:"ProfileCoupons__Content-ActivateCoupon-activate"},React.createElement("input",{name:"giftcard_code",type:"text",className:"ProfileCoupons__Content-ActivateCoupon-activate-input",placeholder:isMobile?translation.activateCoupon.codeShort:translation.activateCoupon.codeLong,value:coupon_code||"",onChange:function onChange(e){if(isCouponActivationLoading)return;_this3.setState({coupon_code:e.target.value})}}),React.createElement("button",{type:"submit",className:"ProfileCoupons__Content-ActivateCoupon-activate-submit",onClick:this.activateCode},React.createElement("span",null,isCouponActivationLoading?React.createElement(LoaderComponent,null):translation.activateCoupon.activate))))),!isMobile&&React.createElement("div",{className:"ProfileCoupons__Content-Tabs"},tabs.map(function(tab){return React.createElement("div",{key:tab.key,className:classNames({"ProfileCoupons__Content-Tabs-Tab":true,active:tab.active})},React.createElement("div",{className:"ProfileCoupons__Content-Tabs-Tab-title",onClick:function onClick(){return _this3.onClickTab(tab)}},tab.name))})),isMobile&&React.createElement("div",{className:"ProfileCoupons__Content-Select"},React.createElement("select",{className:"ProfileCoupons__Content-Select-Items",onChange:this.onChangeTab,onClick:function onClick(e){return e.stopPropagation()},value:active_tab},tabs.map(function(tab){return React.createElement("option",{key:tab.key,value:tab.key,className:classNames({"ProfileCoupons__Content-Select-Items-Item":true,active:tab.active})},tab.name)})),React.createElement("i",{className:"icon icon-chevron-down"})),isLoading&&React.createElement("div",{className:"ProfileCoupons__Content-Loader"},React.createElement(LoaderComponent,null)),React.createElement("div",{className:has_extra_axtion?"ProfileCoupons__Content with-extra-actions":"ProfileCoupons__Content"},!isLoading&&active_tab==="gift-card"&&React.createElement(GiftCard,{translation:translation,marketing_promotions:marketing_promotions,gifcardImagePath:gifcardImagePath}),active_tab==="treatments-present"&&React.createElement(TreatmentsPresent,{translation:translation}),!isLoading&&active_tab==="subscriptions"&&React.createElement(Subscriptions,{translation:translation,marketing_promotions:marketing_promotions}),!isLoading&&active_tab==="vip-card"&&React.createElement(VipCards,{translation:translation,marketing_promotions:marketing_promotions})))}}]);return ProfileCoupons}(BaseComponent);var GiftCard=function(_React$Component){_inherits(GiftCard,_React$Component);function GiftCard(props){_classCallCheck(this,GiftCard);var _this4=_possibleConstructorReturn(this,(GiftCard.__proto__||Object.getPrototypeOf(GiftCard)).call(this,props));_this4.getCouponImage=function(coupon_name){var gifcardImagePath=_this4.props.gifcardImagePath;switch(coupon_name){case"Gift Card":return gifcardImagePath;case"Yellow Pass":return YELLOWPASS_IMAGE_PATH;default:return GIFTCARD_IMAGE_PATH}};_this4.getActivationsItems=function(){var marketing_promotions=_this4.props.marketing_promotions;if(!marketing_promotions)return[];var activations=marketing_promotions.prepaid_credit&&marketing_promotions.prepaid_credit.activations||[];return activations.filter(function(activation){return!activation.has_discount})};_this4.getSentsItems=function(){var marketing_promotions=_this4.props.marketing_promotions;if(!marketing_promotions)return[];var sents=marketing_promotions.prepaid_credit&&marketing_promotions.prepaid_credit.sent||[];return sents.filter(function(sent){return!sent.has_discount})};_this4.state={today:moment()};return _this4}_createClass(GiftCard,[{key:"render",value:function render(){var _this5=this;var translation=this.props.translation;var today=this.state.today;var activations=this.getActivationsItems();var sents=this.getSentsItems();return React.createElement("div",{className:"coupons__gift-card"},React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.giftcardActive),activations.length>0&&React.createElement("div",{className:"wrapper"},activations.map(function(activation,i){if(!activation)return;var is_expired=moment(activation.calculated_valid_to).isBefore(today);var amount=activation.redemption_amount_possible_cents/100;return React.createElement("div",{key:i,className:is_expired?"card expired":"card"},is_expired&&React.createElement("div",{className:"overlay"},React.createElement("img",{src:DISABLED_OVERLAY_PATH,alt:"UALA"}),React.createElement("div",{className:"banner"},React.createElement(NuclearBomb,{color:"#FFFFFF"}),React.createElement("label",null,translation.coupons.expired.format(moment(activation.calculated_valid_to).format("DD/MM/YYYY"))))),React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image"},React.createElement("img",{src:_this5.getCouponImage(activation.name),alt:activation.name})),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.giftCardWithCode.format(activation.code)),React.createElement("span",null,React.createElement(Info,{color:"#939999",onClick:function onClick(){return _this5.setState(_defineProperty({},"bubble_marketing_promotions_"+i,!_this5.state["bubble_marketing_promotions_"+i]))}}),React.createElement("div",{className:!!_this5.state["bubble_marketing_promotions_"+i]?i===0?"bubble first":"bubble":"bubble bubble__hide"},translation.coupons.giftcardBubble))),React.createElement("div",{className:"price"},amount.toCurrency(domainData.default_locale)),React.createElement("div",{className:"note"},React.createElement("div",{className:"sender"},React.createElement(Gift,{color:"#939999"}),React.createElement("label",null,translation.coupons.from.format(activation.gifter_name||"-"))),React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(activation.calculated_valid_from).format("DD/MM/YYYY"),moment(activation.calculated_valid_to).format("DD/MM/YYYY"))}}))))))})),activations.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))),React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.giftcardExpired),React.createElement("div",{className:"cta-wrapper"},React.createElement("div",{className:"button button-transparent",onClick:function onClick(){return window.open("/giftcard","_blank")}},translation.coupons.buyGiftcard)),sents.length>0&&React.createElement("div",{className:"wrapper"},sents.map(function(sent,i){var amount=sent.redemption_amount_possible_cents/100;return React.createElement("div",{key:i,className:"card"},React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image"},React.createElement("img",{src:_this5.getCouponImage(sent.name),alt:sent.name})),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.giftCardWithCode.format(sent.code))),React.createElement("div",{className:"price"},amount.toCurrency(domainData.default_locale)),React.createElement("div",{className:"note"},React.createElement("div",{className:"sender"},React.createElement(Gift,{color:"#939999"}),React.createElement("label",null,translation.coupons.to.format(sent.giftee_name||"-"))),React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(sent.calculated_valid_from).format("DD/MM/YYYY"),moment(sent.calculated_valid_to).format("DD/MM/YYYY"))}}))))))})),sents.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))))}}]);return GiftCard}(React.Component);GiftCard.propTypes={translation:React.PropTypes.object.isRequired,marketing_promotions:React.PropTypes.oneOfType([React.PropTypes.object.isRequired,React.PropTypes.array.isRequired])};var TreatmentsPresent=function(_React$Component2){_inherits(TreatmentsPresent,_React$Component2);function TreatmentsPresent(props){_classCallCheck(this,TreatmentsPresent);var _this6=_possibleConstructorReturn(this,(TreatmentsPresent.__proto__||Object.getPrototypeOf(TreatmentsPresent)).call(this,props));_this6.fetchCouponsReceived=function(){var preloadedState=sessionStorage.getItem("user_coupons_received");if(preloadedState){var coupons_received=JSON.parse(preloadedState);if(!!coupons_received){_this6.setState({isLoading:false})}_this6.setState(coupons_received)}_this6.activations_xhr=$.post("/api/profile/coupons-received",{auth_token:interactiveSignData.user.auth_token});_this6.activations_xhr.then(function(response){if(response.success){_this6.setState({activations:response.data});sessionStorage.setItem("user_coupons_received",JSON.stringify({activations:response.data}))}if(!response.success){Notice.danger(getGenericErrorLabel())}})};_this6.fetchCouponsSents=function(){var preloadedState=sessionStorage.getItem("user_coupons_sents");if(preloadedState){var coupons_sents=JSON.parse(preloadedState);if(!!coupons_sents){_this6.setState({isLoading:false})}_this6.setState(coupons_sents)}_this6.sents_xhr=$.post("/api/profile/coupons-sent",{auth_token:interactiveSignData.user.auth_token});_this6.sents_xhr.then(function(response){if(response.success){_this6.setState({sents:response.data});sessionStorage.setItem("user_coupons_sents",JSON.stringify({sents:response.data}))}if(!response.success){Notice.danger(getGenericErrorLabel())}})};_this6.handleClick=function(e){var convertingElement=_this6.state.convertingElement;if(convertingElement===null)return false;if(document.querySelector("#tp_"+convertingElement).contains(e.target)&&e.target.classList.contains("button-transparent"))return false;_this6.setState({willContinue:null,convertingElement:null})};_this6.convertIntoCredit=function(element_index,activation){var _this6$state=_this6.state,willContinue=_this6$state.willContinue,isLoading=_this6$state.isLoading,activations=_this6$state.activations;if(willContinue===null){_this6.setState({convertingElement:element_index,willContinue:element_index});return false}if(isLoading)return false;_this6.setState({isLoading:true});_this6.xhr=$.post("/api/profile/convert-into-credit",{id:activation.id,auth_token:interactiveSignData.user.auth_token});_this6.xhr.then(function(response){if(response.success){var updated_activations=[].concat(_toConsumableArray(activations));updated_activations[element_index]=_extends({type:"treatments_presents",valid_to_date:response.data.valid_to},response.data);_this6.setState({activations:updated_activations})}_this6.setState({isLoading:false,willContinue:null,convertingElement:null});_this6.focusOnElement(element_index)})};_this6.focusOnElement=function(element_id){var target=!!document.querySelector("#dashboard")?"html, body":".ProfileCoupons";var padding=!!document.querySelector("#dashboard")?20:90;$(target).animate({scrollTop:$("#tp_"+element_id).addClass("focus").offset().top-padding},1e3,function(){setTimeout(function(){$("#tp_"+element_id).removeClass("focus")},5e3)})};_this6.getTreatmentsPresentsStatus=function(treatments_present){if(!!treatments_present.booked_at)return"used";if(!!treatments_present.converted_into_credit_at)return"converted";if(!!treatments_present.valid)return"invalid";if(moment(treatments_present.valid_to_date).isBefore(moment()))return"expired";if(!!treatments_present.redeemed_at)return"redeemed";return""};_this6.state={convertingElement:null,willContinue:null,isLoading:false,activations:null,sents:null};return _this6}_createClass(TreatmentsPresent,[{key:"componentDidMount",value:function componentDidMount(){document.addEventListener("mousedown",this.handleClick,false);this.fetchCouponsReceived();this.fetchCouponsSents()}},{key:"componentWillUnmount",value:function componentWillUnmount(){document.removeEventListener("mousedown",this.handleClick,false);if(this.xhr)this.xhr.abort();if(this.activations_xhr)this.activations_xhr.abort();if(this.sents_xhr)this.sents_xhr.abort()}},{key:"render",value:function render(){var _this7=this;var translation=this.props.translation;var _state2=this.state,convertingElement=_state2.convertingElement,isLoading=_state2.isLoading,willContinue=_state2.willContinue,activations=_state2.activations,sents=_state2.sents;return React.createElement("div",{className:"coupons__treatment-present"},React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.treatmentsPresentActive),!activations&&React.createElement(LoaderComponent,null),activations&&activations.length>0&&React.createElement("div",{className:"wrapper"},activations.map(function(activation,i){if(!activation)return;var status=_this7.getTreatmentsPresentsStatus(activation);var amount=activation.amount_cents/100;return React.createElement("div",{id:"tp_"+i,key:i,className:"card "+status},status==="expired"&&React.createElement("div",{className:"overlay"},React.createElement("img",{src:DISABLED_OVERLAY_PATH,alt:"UALA"}),React.createElement("div",{className:"banner"},React.createElement(NuclearBomb,{color:"#FFFFFF"}),React.createElement("label",null,translation.coupons.expired.format(moment(activation.valid_to).format("DD/MM/YYYY"))))),status==="converted"&&React.createElement("div",{className:"info-banner"},React.createElement(Converted,{color:"#499C7B"}),React.createElement("label",null,translation.coupons.converted.format(amount.toCurrency(domainData.default_locale),moment(activation.valid_to).format("DD/MM/YYYY")))),status==="invalid"&&React.createElement("div",{className:"info-banner"},React.createElement(Converted,{color:"#499C7B"}),React.createElement("label",null,translation.coupons.invalid.format(amount.toCurrency(domainData.default_locale)))),status==="used"&&React.createElement("div",{className:"banner"},React.createElement(CalendarDone,{color:"#499C7B"}),React.createElement("label",null,translation.coupons.redeemed.format(moment(activation.booked_at).format("DD/MM/YYYY")))),React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image venue-thumb"},React.createElement("img",{src:activation.venue.image||VENUE_DEFAULT_THUMB,alt:activation.venue.name})),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.treatmentsPresent),status==="redeemed"&&React.createElement("span",null,React.createElement(Info,{color:"#939999",onClick:function onClick(){return _this7.setState(_defineProperty({},"bubble_treatments_presents_"+i,!_this7.state["bubble_treatments_presents_"+i]))}}),React.createElement("div",{className:!!_this7.state["bubble_treatments_presents_"+i]?i===0?"bubble first":"bubble":"bubble bubble__hide"},translation.coupons.treatmentsPresentReceivedBubble))),React.createElement("div",{className:"treatments"},React.createElement("span",null,activation.venue_treatments.map(function(vt){return vt.name}).join(", "))),React.createElement("div",{className:"note"},React.createElement("div",{className:"location"},React.createElement(LocationPin,{color:"#939999"}),React.createElement("label",null,activation.venue.name)),React.createElement("div",{className:"sender"},React.createElement(Gift,{color:"#939999"}),React.createElement("label",null,translation.coupons.from.format(activation.gifter_name||"-"))),React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(activation.created_at).format("DD/MM/YYYY"),moment(activation.valid_to).format("DD/MM/YYYY"))}}))))),status==="redeemed"&&React.createElement("div",{className:"actions"},React.createElement("div",{className:"button button-transparent",onClick:function onClick(){return _this7.convertIntoCredit(i,activation)}},willContinue===i?convertingElement===i&&isLoading?React.createElement(LoaderComponent,null):translation.coupons.convertConfirm:translation.coupons.convert),React.createElement("div",{className:"button button-yellow",onClick:function onClick(){return window.open("/"+activation.venue.slug+"?coupons_id="+activation.id,"_blank")}},translation.coupons.book)))})),activations&&activations.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))),React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.treatmentsPresentExpired),sents&&sents.length>0&&React.createElement("div",{className:"wrapper"},sents.map(function(sent,i){return React.createElement("div",{key:i,className:"card"},React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image venue-thumb"},React.createElement("img",{src:sent.venue.image||VENUE_DEFAULT_THUMB,alt:sent.venue.name})),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.treatmentsPresent),React.createElement("span",null,React.createElement(Info,{color:"#939999",onClick:function onClick(){return _this7.setState(_defineProperty({},"bubble_treatments_presents_"+i,!_this7.state["bubble_treatments_presents_"+i]))}}),React.createElement("div",{className:!!_this7.state["bubble_treatments_presents_"+i]?i===0?"bubble first":"bubble":"bubble bubble__hide"},React.createElement("div",{dangerouslySetInnerHTML:{__html:translation.coupons.treatmentsPresentSendedBubble}})))),React.createElement("div",{className:"treatments"},React.createElement("span",null,sent.venue_treatments.map(function(vt){return vt.name}).join(", "))),React.createElement("div",{className:"note"},React.createElement("div",{className:"location"},React.createElement(LocationPin,{color:"#939999"}),React.createElement("label",null,sent.venue.name)),React.createElement("div",{className:"sender"},React.createElement(Gift,{color:"#939999"}),React.createElement("label",null,translation.coupons.to.format(sent.giftee_name||"-"))),React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(sent.created_at).format("DD/MM/YYYY"),moment(sent.valid_to).format("DD/MM/YYYY"))}}))))))})),sents&&sents.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))))}}]);return TreatmentsPresent}(React.Component);TreatmentsPresent.propTypes={translation:React.PropTypes.object.isRequired};var Subscriptions=function(_React$Component3){_inherits(Subscriptions,_React$Component3);function Subscriptions(props){_classCallCheck(this,Subscriptions);var _this8=_possibleConstructorReturn(this,(Subscriptions.__proto__||Object.getPrototypeOf(Subscriptions)).call(this,props));var today=moment();var bundles=props.marketing_promotions&&props.marketing_promotions.subscription_bundle&&props.marketing_promotions.subscription_bundle.sent||[];_this8.state={subscriptions_active:bundles.filter(function(sent){return!sent.calculated_valid_to?true:moment(sent.calculated_valid_to).isBefore(today)}),subscriptions_expired:bundles.filter(function(sent){return!sent.calculated_valid_to?false:moment(sent.calculated_valid_to).isSameOrAfter(today)})};return _this8}_createClass(Subscriptions,[{key:"render",value:function render(){var translation=this.props.translation;var _state3=this.state,subscriptions_active=_state3.subscriptions_active,subscriptions_expired=_state3.subscriptions_expired;return React.createElement("div",{className:"coupons__subscriptions"},React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.subscriptionActive),subscriptions_active.length>0&&React.createElement("div",{className:"wrapper"},subscriptions_active.map(function(sent,i){return React.createElement("div",{key:i,className:"card"},React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image card",onClick:function onClick(){return window.open("/"+sent.venue.slug)}},React.createElement("img",{src:sent.venue.image||VENUE_DEFAULT_THUMB,alt:sent.name})),React.createElement("div",{className:"content subscriptions-bundle--content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.subscription),React.createElement("span",null,React.createElement("label",_extends({className:classNames({coupon:true,download:!!sent.pdf_path})},sent.pdf_path?{onClick:function onClick(){return window.open(sent.pdf_path,"_blank")}}:{}),sent.code))),React.createElement("div",{className:"treatments subscriptions-bundle--treatments"},React.createElement("span",null,sent.name)),React.createElement("div",{className:"note subscriptions-bundle--note"},React.createElement("div",{className:"location",onClick:function onClick(){return window.open("/"+sent.venue.slug)}},React.createElement(LocationPin,{color:"#939999"}),React.createElement("label",null,sent.venue.name))),React.createElement("div",{className:"subscriptions-bundle--tags"},sent.formatted_included_resources.map(function(formatted_included_resource,i){var treatment_expired=formatted_included_resource.redemptions_count_used>=formatted_included_resource.redemptions_count_possible;return React.createElement("div",{key:i,className:"subscriptions-bundle--tags-tag"},React.createElement("div",{className:classNames({"subscriptions-bundle--tags-tag--badge":true,expired:treatment_expired})},formatted_included_resource.redemptions_count_used+" / "+formatted_included_resource.redemptions_count_possible+"X"),React.createElement("div",{className:"subscriptions-bundle--tags-tag--name"},formatted_included_resource.names.join(" "+translation.coupons.or+" ")))})))))})),subscriptions_active.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))),subscriptions_expired.length>0&&React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.subscriptionExpired),React.createElement("div",{className:"wrapper"},subscriptions_expired.map(function(sent,i){return React.createElement("div",{key:i,className:"card expired"},React.createElement("div",{className:"overlay"},React.createElement("img",{src:DISABLED_OVERLAY_PATH,alt:"UALA"})),React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"image card",onClick:function onClick(){return window.open("/"+sent.venue.slug)}},React.createElement("img",{src:sent.venue.image||VENUE_DEFAULT_THUMB,alt:sent.name})),React.createElement("div",{className:"content subscriptions-bundle--content"},React.createElement("div",{className:"title"},React.createElement("label",null,translation.coupons.subscription),React.createElement("span",null,React.createElement("label",_extends({className:classNames({coupon:true,download:!!sent.pdf_path})},sent.pdf_path?{onClick:function onClick(){return window.open(sent.pdf_path,"_blank")}}:{}),sent.code))),React.createElement("div",{className:"treatments subscriptions-bundle--treatments"},React.createElement("span",null,sent.name)),React.createElement("div",{className:"note"},React.createElement("div",{className:"location",onClick:function onClick(){return window.open("/"+sent.venue.slug)}},React.createElement(LocationPin,{color:"#939999"}),React.createElement("label",null,sent.venue.name))),React.createElement("div",{className:"subscriptions-bundle--tags"},sent.formatted_included_resources.map(function(formatted_included_resource,i){var treatment_expired=formatted_included_resource.redemptions_count_used>=formatted_included_resource.redemptions_count_possible;return React.createElement("div",{key:i,className:"subscriptions-bundle--tags-tag"},React.createElement("div",{className:classNames({"subscriptions-bundle--tags-tag--badge":true,expired:treatment_expired})},formatted_included_resource.redemptions_count_used+" / "+formatted_included_resource.redemptions_count_possible+"X"),React.createElement("div",{className:"subscriptions-bundle--tags-tag--name"},formatted_included_resource.names.join(" "+translation.coupons.or+" ")))})))))}))))}}]);return Subscriptions}(React.Component);Subscriptions.propTypes={
translation:React.PropTypes.object.isRequired,marketing_promotions:React.PropTypes.oneOfType([React.PropTypes.object.isRequired,React.PropTypes.array.isRequired])};var VipCards=function(_React$Component4){_inherits(VipCards,_React$Component4);function VipCards(props){_classCallCheck(this,VipCards);var _this9=_possibleConstructorReturn(this,(VipCards.__proto__||Object.getPrototypeOf(VipCards)).call(this,props));_this9.getActivationsItems=function(){var marketing_promotions=_this9.props.marketing_promotions;if(!marketing_promotions)return[];var activations=marketing_promotions.prepaid_credit&&marketing_promotions.prepaid_credit.activations||[];return activations.filter(function(activation){return activation.has_discount})};_this9.getSentsItems=function(){var marketing_promotions=_this9.props.marketing_promotions;if(!marketing_promotions)return[];var sents=marketing_promotions.prepaid_credit&&marketing_promotions.prepaid_credit.sent||[];return sents.filter(function(sent){return sent.has_discount})};_this9.state={today:moment()};return _this9}_createClass(VipCards,[{key:"render",value:function render(){var translation=this.props.translation;var today=this.state.today;var activations=this.getActivationsItems();var sents=this.getSentsItems();return React.createElement("div",{className:"coupons__vip-card"},React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.vipcardActive),activations.length>0&&React.createElement("div",{className:"wrapper"},activations.map(function(activation,i){if(!activation)return;var is_expired=moment(activation.calculated_valid_to).isBefore(today);var amount=activation.redemption_amount_possible_cents/100;return React.createElement("div",{key:i,className:is_expired?"card expired":"card"},is_expired&&React.createElement("div",{className:"overlay"},React.createElement("img",{src:DISABLED_OVERLAY_PATH,alt:"UALA"}),React.createElement("div",{className:"banner"},React.createElement(NuclearBomb,{color:"#FFFFFF"}),React.createElement("label",null,translation.coupons.expired.format(moment(activation.calculated_valid_to).format("DD/MM/YYYY"))))),React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"vip-card"},translation.coupons.vipCard),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,activation.name),React.createElement("span",null,React.createElement("label",_extends({className:classNames({coupon:true,download:!!activations.pdf_path})},activations.pdf_path?{onClick:function onClick(){return window.open(activations.pdf_path,"_blank")}}:{}),activations.code))),React.createElement("div",{className:"price"},amount.toCurrency(domainData.default_locale)),React.createElement("div",{className:"note"},React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),activation.calculated_valid_to?React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(activation.calculated_valid_from).format("DD/MM/YYYY"),moment(activation.calculated_valid_to).format("DD/MM/YYYY"))}}):React.createElement("label",null,translation.coupons.noExpiration))))))})),activations.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))),React.createElement("div",{className:"coupons"},React.createElement("h3",null,translation.coupons.vipcardExpired),sents.length>0&&React.createElement("div",{className:"wrapper"},sents.map(function(sent,i){var used_amount=(sent.redemption_amount_possible_cents-sent.redemption_amount_used_cents)/100;var total_amount=sent.redemption_amount_possible_cents/100;return React.createElement("div",{key:i,className:"card"},React.createElement("div",{className:"content-wrapper"},React.createElement("div",{className:"vip-card"},translation.coupons.vipCard),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},React.createElement("label",null,sent.name),React.createElement("span",null,React.createElement("label",_extends({className:classNames({coupon:true,download:!!sent.pdf_path})},sent.pdf_path?{onClick:function onClick(){return window.open(sent.pdf_path,"_blank")}}:{}),sent.code))),React.createElement("div",{className:"amount-wrapper"},React.createElement("div",{className:"used-price"},used_amount.toCurrency(domainData.default_locale)),React.createElement("span",null,"/"),React.createElement("div",{className:"price"},total_amount.toCurrency(domainData.default_locale))),React.createElement("div",{className:"note"},React.createElement("div",{className:"date"},React.createElement(CalendarIcon,{color:"#939999"}),sent.calculated_valid_to?React.createElement("label",{dangerouslySetInnerHTML:{__html:translation.coupons.validSince.format(moment(sent.calculated_valid_from).format("DD/MM/YYYY"),moment(sent.calculated_valid_to).format("DD/MM/YYYY"))}}):React.createElement("label",null,translation.coupons.noExpiration))))))})),sents.length===0&&React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"separator"}))))}}]);return VipCards}(React.Component);VipCards.propTypes={translation:React.PropTypes.object.isRequired,marketing_promotions:React.PropTypes.oneOfType([React.PropTypes.object.isRequired,React.PropTypes.array.isRequired])};
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var getGenericErrorLabel=function getGenericErrorLabel(){return genericTranslationData&&genericTranslationData.translation&&genericTranslationData.translation.notice&&genericTranslationData.translation.notice.apiGenericError||"Error"};var ProfileOrders=function(_React$Component){_inherits(ProfileOrders,_React$Component);function ProfileOrders(props){_classCallCheck(this,ProfileOrders);var _this=_possibleConstructorReturn(this,(ProfileOrders.__proto__||Object.getPrototypeOf(ProfileOrders)).call(this,props));_this.isMobile=function(){return window.innerWidth<640};_this.fetchUserOrders=function(next_page){var _this$state=_this.state,orders=_this$state.orders,page=_this$state.page,per_page=_this$state.per_page;_this.xhr=$.post("/api/orders/list",{auth_token:interactiveSignData.user.auth_token,page:next_page||page,per_page:per_page});_this.xhr.then(function(response){if(response.success){var updated_orders=[].concat(_toConsumableArray(orders),_toConsumableArray(response.data));_this.setState({isLoading:false,orders:updated_orders,load_more:response.totalOrders>updated_orders.length});sessionStorage.setItem("user_orders",JSON.stringify({orders:updated_orders}))}if(!response.success){_this.setState({isLoading:false});Notice.danger(getGenericErrorLabel())}})};_this.handleOrderDetails=function(id){var preloadedState=sessionStorage.getItem("user_orders_details-"+id);if(preloadedState){var details=JSON.parse(preloadedState);_this.setState(details)}if(!preloadedState){_this.setState({isLoading:true})}_this.xhr=$.post("/api/orders/detail",{id:id,auth_token:interactiveSignData.user.auth_token});_this.xhr.then(function(response){if(response.success){_this.setState({isLoading:false,order_details:response.data});sessionStorage.setItem("user_orders_details-"+id,JSON.stringify({order_details:response.data}))}if(!response.success){_this.setState({isLoading:false});Notice.danger(getGenericErrorLabel())}})};_this.getOrderStatusLabel=function(order){var translation=_this.props.translation;if(order.state==="shipped"){var locale=domainData.default_locale||"en";var shipping_date=moment(order.shipping_date).locale(locale).format("DD MMM");return translation.order.state[order.state].format(shipping_date)}return translation.order.state[order.state]};_this.getOrderDateLabel=function(order){var translation=_this.props.translation;if(!order&&!order.created_at)return null;var locale=domainData.default_locale||"en";var order_date=moment(order.created_at);var today=moment();var tomorrow=moment().add(1,"days");var yesterday=moment().subtract(1,"days");if(order_date.isSame(today,"day"))return translation.order.today;if(order_date.isSame(tomorrow,"day"))return translation.order.tomorrow;if(order_date.isSame(yesterday,"day"))return translation.order.yesterday;return order_date.locale(locale).format("DD MMM").capitalize()};_this.getHumanReadableDeliveryTime=function(time_in_seconds){var locale=domainData.default_locale||"en";return moment().subtract(time_in_seconds,"seconds").locale(locale).toNow()};_this.state={isLoading:false,page:1,per_page:5,orders:[],order_details:null,load_more:false};return _this}_createClass(ProfileOrders,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var preloadedState=sessionStorage.getItem("user_orders");if(preloadedState){var orders=JSON.parse(preloadedState);this.setState(orders)}if(!preloadedState){this.setState({isLoading:true})}this.fetchUserOrders();window.addEventListener("resize",this.onWindowResize=function(){_this2.setState({isMobile:_this2.isMobile()})})}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.xhr)this.xhr.abort();window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function render(){var _this3=this;var translation=this.props.translation;var _state=this.state,isLoading=_state.isLoading,orders=_state.orders,order_details=_state.order_details,load_more=_state.load_more;return React.createElement("div",{className:order_details?"ProfileOrders details":"ProfileOrders"},isLoading&&React.createElement("div",{className:"ProfileOrders-Loader"},React.createElement(LoaderComponent,null)),order_details?React.createElement("div",{className:"ProfileOrders-header"},React.createElement("div",{className:"ProfileOrders-header-actions"},React.createElement("i",{className:"icon icon-chevron-left",onClick:function onClick(){return _this3.setState({order_details:null})}})),React.createElement("h1",null,React.createElement("b",null,translation.order.orderDetails.format(order_details.order_number))),React.createElement("div",{className:"ProfileOrders-header-actions"})):React.createElement("div",{className:isLoading?"ProfileOrders-header is-loading":"ProfileOrders-header"},React.createElement("div",{className:"ProfileOrders-header-actions"}),React.createElement("h1",null,translation.order.title),React.createElement("div",{className:"ProfileOrders-header-actions"})),React.createElement("div",{className:isLoading?"ProfileOrders-content is-loading":"ProfileOrders-content"},!order_details&&React.createElement("div",{className:"ProfileOrders-orders"},orders.map(function(order){return React.createElement(Order,{key:order.id,id:order.id,translation:translation,price:order.final_price,image:order.order_image,venue:order.venue,date:_this3.getOrderDateLabel(order),status:_this3.getOrderStatusLabel(order),isMobile:_this3.isMobile,onOrderDetails:_this3.handleOrderDetails})})),order_details&&React.createElement(OrderDetail,{order:order_details,translation:translation,getOrderStatusLabel:this.getOrderStatusLabel,getHumanReadableDeliveryTime:this.getHumanReadableDeliveryTime})),load_more&&!order_details&&React.createElement("div",{className:isLoading?"load-more-wrapper is-loading":"load-more-wrapper"},React.createElement("div",{className:"button button-transparent",onClick:function onClick(){_this3.setState({isLoading:true});var next_page=_this3.state.page+1;_this3.fetchUserOrders(next_page)}},this.props.translation.loadMore)))}}]);return ProfileOrders}(React.Component);var Order=function Order(_ref){var id=_ref.id,translation=_ref.translation,image=_ref.image,date=_ref.date,price=_ref.price,status=_ref.status,venue=_ref.venue,isMobile=_ref.isMobile,onOrderDetails=_ref.onOrderDetails;return React.createElement("div",_extends({className:"ProfileOrders-order"},isMobile?{onClick:function onClick(){return onOrderDetails(id)}}:{}),React.createElement("div",{className:"ProfileOrders-order-image"},React.createElement("img",{src:image||"https://via.placeholder.com/150/CCCCCC/CCCCCC",alt:venue.name})),React.createElement("div",{className:"ProfileOrders-order-info"},React.createElement("div",{className:"ProfileOrders-order-info-date"},date),React.createElement("div",{className:"ProfileOrders-order-info-data"},React.createElement("div",{className:"ProfileOrders-order-info-price"},price.toCurrency(genericData.getCurrentLanguage)),React.createElement("div",{className:"ProfileOrders-order-info-state"},status)),React.createElement("div",{className:"ProfileOrders-order-info-venue"},venue.name)),React.createElement("div",{className:"ProfileOrders-order-actions"},React.createElement("div",_extends({className:"ProfileOrders-order-action-details"},!isMobile?{onClick:function onClick(){return onOrderDetails(id)}}:{}),translation.order.seeDetails)))};var OrderDetail=function OrderDetail(_ref2){var order=_ref2.order,translation=_ref2.translation,getOrderStatusLabel=_ref2.getOrderStatusLabel,getHumanReadableDeliveryTime=_ref2.getHumanReadableDeliveryTime;return React.createElement("div",{className:"ProfileOrders-details"},React.createElement("div",{className:"ProfileOrders-details-customer"},React.createElement("div",{className:"ProfileOrders-details-customer-status"},order.state==="rejected"?getOrderStatusLabel(order):order.state==="shipped"?getOrderStatusLabel(order):translation.order.details.state.format(getOrderStatusLabel(order))),React.createElement("div",{className:"ProfileOrders-details-customer-fullname"},order.address.full_name),React.createElement("div",{className:"ProfileOrders-details-customer-address"},React.createElement("span",null,""+order.address.address+(order.address.secondary_address?" ("+order.address.secondary_address+")":"")),React.createElement("span",null,order.address.zip+" "+order.address.city)),order.tracking_number&&React.createElement("div",{className:"ProfileOrders-details-traking",dangerouslySetInnerHTML:{__html:translation.order.details.trakingNumber.format(order.tracking_number)}})),React.createElement("div",{className:"ProfileOrders-details-items"},order.cart.items.map(function(item,i){return React.createElement("div",{key:i,className:"ProfileOrders-details-item"},React.createElement("div",{className:"ProfileOrders-details-item-image"},React.createElement("img",{src:item.main_image,alt:item.name})),React.createElement("div",{className:"ProfileOrders-details-item-name"},item.name),React.createElement("div",{className:"ProfileOrders-details-item-price"},item.total_price.toCurrency(genericData.getCurrentLanguage)))})),React.createElement("div",{className:"ProfileOrders-details-extra"},React.createElement("div",{className:"ProfileOrders-details-extra-line"},React.createElement("span",null,translation.order.details.shipping.format(order.shipping_option.name,getHumanReadableDeliveryTime(order.shipping_option.delivery_time))),React.createElement("span",null,order.shipping_price.toCurrency(genericData.getCurrentLanguage))),React.createElement("div",{className:"ProfileOrders-details-extra-line"},React.createElement("span",null,translation.order.details.subtotal),React.createElement("span",null,order.total_price.toCurrency(genericData.getCurrentLanguage)))),React.createElement("div",{className:"ProfileOrders-details-total"},React.createElement("label",null,translation.order.details.total),React.createElement("span",null,order.final_price.toCurrency(genericData.getCurrentLanguage))))};
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UserAccount=function(_React$Component){_inherits(UserAccount,_React$Component);function UserAccount(props){_classCallCheck(this,UserAccount);var _this=_possibleConstructorReturn(this,(UserAccount.__proto__||Object.getPrototypeOf(UserAccount)).call(this,props));_this.handleFieldUpdate.bind(_this);_this.handlePasswordUpdate.bind(_this);_this.updatePrivacyOptions.bind(_this);return _this}_createClass(UserAccount,[{key:"componentWillMount",value:function componentWillMount(){var translation=this.props.translation;var labels={fullName:translation.fullName,email:translation.email,countryCode:"+"+genericData.getCurrentCountryCode(),phone:translation.phone,address:translation.address,birthday:translation.birthday,gender:translation.gender};profileData.privacySettings=Object.keys(profileData.privacySettings).reduce(function(o,k){if(profileData.privacySettings[k]==="true"||profileData.privacySettings[k]==="false"){o[k]=profileData.privacySettings[k]==="true";return o}o[k]=profileData.privacySettings[k];return o},{});this.state=_extends({},this.state,{fields:Object.keys(profileData.userAccount).map(function(key){return{key:key,value:profileData.userAccount[key],label:labels[key]}}),password:"",currentPassword:"",passwordConfirmation:"",messages:{},thumbnail:sessionStorage.getItem("facebookAvatar")?sessionStorage.getItem("facebookAvatar"):profileData.thumbnail,translation:translation,privacySettings:profileData.privacySettings,privacyMarketingOptions:profileData.privacySettings.shouldReceiveMarketingSmsNotifications||profileData.privacySettings.shouldReceiveMarketingEmailNotifications||profileData.privacySettings.shouldReceiveMarketingPushNotifications,settingsTabCollapsed:false,resetAuthToken:true,provider:profileData.provider})}},{key:"handleLogout",value:function handleLogout(){var _this2=this;OverlayHandler.hide();window.setTimeout(function(){showModalMessage({message:_this2.state.translation.logoutMessage,icon:modalMessageIcons.WARNING,actions:[{name:_this2.state.translation.logoutConfirm,type:modalMessageTypes.WARN,href:profileData.logoutUrl}]},{blur:true},null,454,303)},400)}},{key:"togglePasswordChangeForm",value:function togglePasswordChangeForm(show){this.setState(_extends({},this.state,{showPasswordChangeForm:typeof show==="boolean"?show:!this.state.showPasswordChangeForm}))}},{key:"mapFields",value:function mapFields(){var _this3=this;var formData={};this.state.fields.filter(function(_ref){var key=_ref.key,value=_ref.value;return key&&value}).map(function(_ref2){var key=_ref2.key,value=_ref2.value;switch(key){case"fullName":formData=_extends({},formData,_this3.splitFullName(value));break;default:formData=_extends({},formData,_defineProperty({},key,value))}});return formData}},{key:"requestPasswordChange",value:function requestPasswordChange(){var _this4=this;var _state=this.state,_state$currentPasswor=_state.currentPassword,currentPassword=_state$currentPasswor===undefined?"":_state$currentPasswor,_state$password=_state.password,password=_state$password===undefined?"":_state$password,_state$passwordConfir=_state.passwordConfirmation,passwordConfirmation=_state$passwordConfir===undefined?"":_state$passwordConfir,_state$resetAuthToken=_state.resetAuthToken,resetAuthToken=_state$resetAuthToken===undefined?true:_state$resetAuthToken;if(currentPassword.length&&password.length&&passwordConfirmation.length){this.setState(_extends({},this.state,{requestingPasswordChange:true}));var formData=this.mapFields();if(this.xhr)this.xhr.abort();this.xhr=$.post(profileData.updateUrl,_extends({},formData,{currentPassword:currentPassword,password:password,passwordConfirmation:passwordConfirmation,resetAuthToken:resetAuthToken}));this.xhr.then(function(_ref3){var success=_ref3.success,resetted=_ref3.resetted,messages=_ref3.messages;var extras={};if(resetted){return location.reload()}if(!success){extras={messages:_extends({},_this4.state.messages,messages.form||messages.global&&messages.global.join(", ")||"Error")}}else{extras={currentPassword:"",password:"",passwordConfirmation:"",resetAuthToken:true,messages:{}}}_this4.setState(_extends({},_this4.state,{showPasswordChangeForm:!success,requestingPasswordChange:false},extras))})}}},{key:"splitFullName",value:function splitFullName(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var splitValue=value.trim().split(/\s+/);return{firstName:splitValue.shift(),lastName:splitValue.reduce(function(res){var str=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return res+" "+str},"").trim()}}},{key:"handleFieldUpdate",value:function handleFieldUpdate(fieldKey,valueToUpdate){var _this5=this;var _state$fields=this.state.fields,fields=_state$fields===undefined?[]:_state$fields;var indexToUpdate=fields.map(function(_ref4){var _ref4$key=_ref4.key,key=_ref4$key===undefined?"":_ref4$key;return key}).indexOf(fieldKey);if(indexToUpdate>=0&&fields[indexToUpdate].value!==valueToUpdate){fields[indexToUpdate]=_extends({},fields[indexToUpdate],{value:fieldKey==="birthday"?moment(valueToUpdate,"DD / MM / YYYY").format("YYYY-MM-DD"):valueToUpdate});this.setState(_extends({},this.state,{fields:fields,messages:{},requestingProfileUpdate:true}));var formData=this.mapFields();if(this.xhr)this.xhr.abort();this.xhr=$.post(profileData.updateUrl,formData);this.xhr.then(function(_ref5){var success=_ref5.success,messages=_ref5.messages;var extras={};if(success){fields.filter(function(_ref6){var key=_ref6.key,value=_ref6.value;return key&&value}).map(function(_ref7){var key=_ref7.key,value=_ref7.value;return profileData.userAccount[key]=value})}else{extras={messages:messages.form||messages.global&&messages.global.join(", ")||"Error"};Notice.danger(extras.messages)}_this5.setState(_extends({},_this5.state,extras,{requestingProfileUpdate:false}));if($("#phone-group-countryCode input").val()==="+"){$("#phone-group-countryCode input").val("")}})}}},{key:"handlePasswordUpdate",value:function handlePasswordUpdate(key,value){this.setState(_extends({},this.state,_defineProperty({},key,value)))}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.xhr)this.xhr.abort()}},{key:"componentDidMount",value:function componentDidMount(){this.animatePhoneGroupField()}},{key:"animatePhoneGroupField",value:function animatePhoneGroupField(){$("#phone-group-countryCode input").on("focus",function(){$("#phone-group-countryCode .placeholder-dynamic").hide();if($("#phone-group-phone input").val()===""){$("#phone-group-phone .form-group").addClass("focus")}if($(this).val()===""){$(this).val("+");$("#phone-group-countryCode .placeholder-dynamic").hide()}});$("#phone-group-countryCode input").on("blur",function(){if($("#phone-group-phone input").val()===""){$("#phone-group-phone .form-group").removeClass("focus")}if($(this).val()==="+"){$(this).val("")}if($(this).val()===""){$("#phone-group-countryCode .placeholder-dynamic").show();$("#phone-group-countryCode .form-group").removeClass("not-empty").removeClass("focus")}});$("#phone-group-phone input").on("focus",function(){$("#phone-group-countryCode").show()});$("#phone-group-phone input").on("blur",function(){if($("#phone-group-countryCode input").val()==="+"){$("#phone-group-countryCode input").val("")}})}},{key:"handleCountryCodeKeyUp",value:function handleCountryCodeKeyUp(event){return event.target.value=event.target.value.replace(/[^\+0-9]+/g,"")}},{key:"deleteUserProfile",value:function deleteUserProfile(){(new ModalHandler).show(React.createElement(DeleteAccountReact,{translation:this.state.translation,user:profileData.userAccount}),{width:454,height:"auto",additionalClass:"delete-account"})}},{key:"updatePrivacyOptions",value:function updatePrivacyOptions(event,option){var _this6=this;var isChanged=false;var privacySettings=_extends({},this.state.privacySettings);if(option==="privacyMarketingOptions"){privacySettings.shouldReceiveMarketingSmsNotifications=!this.state.privacyMarketingOptions;privacySettings.shouldReceiveMarketingEmailNotifications=!this.state.privacyMarketingOptions;privacySettings.shouldReceiveMarketingPushNotifications=!this.state.privacyMarketingOptions;this.setState({privacyMarketingOptions:!this.state.privacyMarketingOptions,privacySettings:privacySettings});isChanged=true}if(option==="privacyMarketingSms"){privacySettings.shouldReceiveMarketingSmsNotifications=!JSON.parse(this.state.privacySettings.shouldReceiveMarketingSmsNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyMarketingEmail"){privacySettings.shouldReceiveMarketingEmailNotifications=!JSON.parse(this.state.privacySettings.shouldReceiveMarketingEmailNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyMarketingPush"){privacySettings.shouldReceiveMarketingPushNotifications=!JSON.parse(this.state.privacySettings.shouldReceiveMarketingPushNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyNotificationSms"){privacySettings.shouldReceiveSmsNotifications=!JSON.parse(this.state.privacySettings.shouldReceiveSmsNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyNotificationEmail"){privacySettings.shouldReceiveEmailNotifications=!JSON.parse(this.state.privacySettings.shouldReceiveEmailNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyNotificationPush"){privacySettings.shouldReceivePushNotifications=!JSON.parse(this.state.privacySettings.shouldReceivePushNotifications);this.setState({privacySettings:privacySettings});isChanged=true}if(option==="privacyProfilation"){privacySettings.profilationRequestedAt=!this.state.privacySettings.profilationRequestedAt;privacySettings.profilationAcceptedAt=!this.state.privacySettings.profilationAcceptedAt;this.setState({privacySettings:privacySettings});isChanged=true}if(isChanged){this.setState({requestingProfileUpdate:true});var formData=this.mapFields();formData=_extends({},formData,privacySettings);if(this.xhr)this.xhr.abort();this.xhr=$.post(profileData.updateUrl,formData);this.xhr.then(function(_ref8){var success=_ref8.success,messages=_ref8.messages;if(!success){Notice.danger(messages.form||messages.global&&messages.global.join(", ")||"Error")}_this6.setState({requestingProfileUpdate:false});profileData.privacySettings=_extends({},profileData.privacySettings,formData)})}}},{key:"collapseSettingsTab",value:function collapseSettingsTab(){this.setState({settingsTabCollapsed:!this.state.settingsTabCollapsed,resetAuthToken:true});$(".settings-extended").slideToggle();$(".privacy").slideToggle()}},{key:"render",value:function render(){var _this7=this;var _state2=this.state,_state2$fields=_state2.fields,fields=_state2$fields===undefined?[]:_state2$fields,_state2$thumbnail=_state2.thumbnail,thumbnail=_state2$thumbnail===undefined?{}:_state2$thumbnail,_state2$messages=_state2.messages,messages=_state2$messages===undefined?{}:_state2$messages,_state2$showPasswordC=_state2.showPasswordChangeForm,showPasswordChangeForm=_state2$showPasswordC===undefined?false:_state2$showPasswordC,_state2$requestingPas=_state2.requestingPasswordChange,requestingPasswordChange=_state2$requestingPas===undefined?false:_state2$requestingPas,_state2$requestingPro=_state2.requestingProfileUpdate,requestingProfileUpdate=_state2$requestingPro===undefined?false:_state2$requestingPro,_state2$currentPasswo=_state2.currentPassword,currentPassword=_state2$currentPasswo===undefined?"":_state2$currentPasswo,_state2$password=_state2.password,password=_state2$password===undefined?"":_state2$password,_state2$passwordConfi=_state2.passwordConfirmation,passwordConfirmation=_state2$passwordConfi===undefined?"":_state2$passwordConfi;var privacyMarketingOptions=classNames({"checkbox-custom":true,"checkbox-large":true,active:JSON.parse(this.state.privacySettings.shouldReceiveMarketingSmsNotifications)||JSON.parse(this.state.privacySettings.shouldReceiveMarketingEmailNotifications)||JSON.parse(this.state.privacySettings.shouldReceiveMarketingPushNotifications)});var privacyMarketingSms=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceiveMarketingSmsNotifications)});var privacyMarketingEmail=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceiveMarketingEmailNotifications)});var privacyMarketingPush=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceiveMarketingPushNotifications)});var privacyNotificationSms=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceiveSmsNotifications)});var privacyNotificationEmail=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceiveEmailNotifications)});var privacyNotificationPush=classNames({"checkbox-custom":true,active:JSON.parse(this.state.privacySettings.shouldReceivePushNotifications)});var privacyProfilation=classNames({"checkbox-custom":true,"checkbox-large":true,active:this.state.privacySettings.profilationAcceptedAt});var settingsTab=classNames({icon:true,"icon-chevron-up":!this.state.settingsTabCollapsed,"icon-chevron-down":this.state.settingsTabCollapsed});var resetAuthToken=classNames({"checkbox-custom":true,active:this.state.resetAuthToken});return React.createElement("div",{className:"user-account"},React.createElement("div",{className:"profile-card",ref:function ref(card){_this7.card=card}},React.createElement("div",{className:"picture "+(requestingProfileUpdate?"loading":"")},React.createElement("div",{className:"circular-stepper-container"},React.createElement(CircularStepper,{size:90,strokeWidth:6,completion:100/3,animate:requestingProfileUpdate})),React.createElement("div",{className:"image",style:{backgroundImage:thumbnail?"url('"+thumbnail+"')":"none",backgroundSize:"cover"}},thumbnail.length<=0?React.createElement("i",{className:"icon icon-bomb"}):null)),React.createElement("div",{className:"form"},fields.map(function(_ref9){var _ref9$key=_ref9.key,key=_ref9$key===undefined?"":_ref9$key,_ref9$label=_ref9.label,label=_ref9$label===undefined?"":_ref9$label,_ref9$value=_ref9.value,value=_ref9$value===undefined?"":_ref9$value;return React.createElement("div",{className:"field",key:key,id:key==="phone"||key==="countryCode"?"phone-group-"+key:null},React.createElement(FormGroup,_extends({label:label,name:key,placeholder:label,value:key==="birthday"?value?moment(value).format("DD / MM / YYYY"):value:value,onBlur:function onBlur(_ref10){var _ref10$target=_ref10.target,target=_ref10$target===undefined?{}:_ref10$target;return _this7.handleFieldUpdate(key,target.value)},message:messages[key]?messages[key][0]:null,maxLength:key==="countryCode"?"4":null,onKeyUp:key==="countryCode"?_this7.handleCountryCodeKeyUp:null},key==="birthday"?{type:"mask",maskType:"text",mask:"11 / 11 / 1111",maskPlaceholder:"00 / 00 / 0000"}:{},key==="gender"?{onChange:function onChange(value){return _this7.handleFieldUpdate(key,value)}}:{},key==="gender"?{type:"checkbox",class:"user-gender",switch_on_value:"m",switch_off_value:"f"}:{})),React.createElement("div",{className:"message"},messages[key]?messages[key][0]:null))}))),React.createElement("div",{className:"profile-card extended-options",ref:function ref(card){_this7.card=card}},React.createElement("div",{className:"actions"},React.createElement("header",null,React.createElement("span",null,this.state.translation.impostazioni),React.createElement("i",{className:settingsTab,onClick:this.collapseSettingsTab.bind(this)})),React.createElement("div",{className:"privacy"},React.createElement("div",{className:"privacy-wrapper"},React.createElement("header",null,this.state.translation.consensiPrivacy),React.createElement("div",{className:"privacy-content"},React.createElement("div",{className:privacyMarketingOptions,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyMarketingOptions")}}),React.createElement("div",{className:"privacy-info"},React.createElement("div",{className:"privacy-description",dangerouslySetInnerHTML:{__html:this.state.translation.consensiPrivacyDescription}}),React.createElement("div",{className:"privacy-check"},React.createElement("span",null,React.createElement("div",{className:"privacy-check-title"},this.state.translation.comunicazioniSMS),React.createElement("div",{className:privacyMarketingSms,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyMarketingSms")}})),React.createElement("span",null,React.createElement("div",{className:"privacy-check-title"},this.state.translation.comunicazioniEmail),React.createElement("div",{className:privacyMarketingEmail,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyMarketingEmail")}})),React.createElement("span",null,React.createElement("div",{className:"privacy-check-title"},this.state.translation.comunicazioniPush),React.createElement("div",{className:privacyMarketingPush,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyMarketingPush")}})))))),React.createElement("div",{className:"privacy-wrapper"},React.createElement("header",null,this.state.translation.comunicazioniServizio),React.createElement("div",{className:"privacy-content"},React.createElement("div",{className:"privacy-info"},React.createElement("div",{className:"privacy-description",dangerouslySetInnerHTML:{__html:this.state.translation.comunicazioniServizioDescription}}),React.createElement("div",{className:"privacy-check"},React.createElement("span",null,React.createElement("div",{className:"privacy-check-title gray-darker"},this.state.translation.comunicazioniSMS),React.createElement("div",{className:privacyNotificationSms,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyNotificationSms")}})),React.createElement("span",null,React.createElement("div",{className:"privacy-check-title gray-darker"},this.state.translation.comunicazioniEmail),React.createElement("div",{className:privacyNotificationEmail,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyNotificationEmail")}})),React.createElement("span",null,React.createElement("div",{className:"privacy-check-title gray-darker"},this.state.translation.comunicazioniPush),React.createElement("div",{className:privacyNotificationPush,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyNotificationPush")}})))))),React.createElement("div",{className:"privacy-wrapper"},React.createElement("header",null,this.state.translation.suggerimentiPersonalizzati),React.createElement("div",{className:"privacy-content"},React.createElement("div",{className:privacyProfilation,onClick:function onClick(e){return _this7.updatePrivacyOptions(e,"privacyProfilation")}}),React.createElement("div",{className:"privacy-info"},React.createElement("div",{className:"privacy-description",dangerouslySetInnerHTML:{__html:this.state.translation.suggerimentiPersonalizzatiDescription}}))))),React.createElement("div",{className:"base settings-extended"},React.createElement("div",{className:"form change-password",style:{display:showPasswordChangeForm?"block":"none"}},React.createElement("div",{className:"title"},this.state.translation.changePassword),React.createElement("div",{className:"field"},React.createElement(FormGroup,{label:this.state.translation.changePasswordLabel,name:"currentPassword",type:"password",placeholder:this.state.translation.changePasswordPlaceholder,message:messages["current_password"]?messages["current_password"][0]:null,value:currentPassword,onChange:function onChange(_ref11){var _ref11$target=_ref11.target,target=_ref11$target===undefined?{}:_ref11$target;return _this7.handlePasswordUpdate("currentPassword",target.value)}}),React.createElement("div",{className:"message"},messages["current_password"]?messages["current_password"]:null)),React.createElement("div",{className:"field"},React.createElement(FormGroup,{label:this.state.translation.newPasswordLabel,name:"password",type:"password",placeholder:this.state.translation.newPasswordPlaceholder,message:messages["password"]?messages["password"][0]:null,value:password,onChange:function onChange(_ref12){var _ref12$target=_ref12.target,target=_ref12$target===undefined?{}:_ref12$target;return _this7.handlePasswordUpdate("password",target.value)}}),React.createElement("div",{className:"message"},messages["password"]?messages["password"]:null)),React.createElement("div",{className:"field"},React.createElement(FormGroup,{label:this.state.translation.repeatPasswordLabel,name:"passwordConfirmation",type:"password",placeholder:this.state.translation.repeatPasswordPlaceholder,value:passwordConfirmation,message:messages["passwordConfirmation"]?messages["passwordConfirmation"][0]:null,onChange:function onChange(_ref13){var _ref13$target=_ref13.target,target=_ref13$target===undefined?{}:_ref13$target;return _this7.handlePasswordUpdate("passwordConfirmation",target.value)}}),React.createElement("div",{className:"message"},messages["passwordConfirmation"]?messages["passwordConfirmation"]:null)),React.createElement("div",{className:"field reset-profiles-content"},React.createElement("div",{className:resetAuthToken,onClick:function onClick(){return _this7.setState({resetAuthToken:!_this7.state.resetAuthToken})}}),React.createElement("div",{className:"reset-profiles-info"},React.createElement("div",{className:"reset-profiles-description"},this.state.translation.resetAuthToken))),React.createElement("div",{className:"submit"},React.createElement("div",null,this.state.translation.changePasswordButton),React.createElement("div",{className:"button-loader-wrapper "+(requestingPasswordChange?"loading":"")},React.createElement(CircularStepper,{size:60,strokeWidth:4,completion:100/3,animate:requestingPasswordChange}),React.createElement("button",{className:"button button-circle button-yellow button-shadow",disabled:false,onClick:this.requestPasswordChange.bind(this)},React.createElement("span",{className:"icon icon-arrow"}))))),this.state.provider.inArray(["facebook"])?null:React.createElement("span",{className:"change-password",onClick:this.togglePasswordChangeForm.bind(this)},React.createElement("i",{className:"icon icon-lock"}),React.createElement("span",null,showPasswordChangeForm?this.state.translation.abortCangePassword:this.state.translation.changePasswordButton)),React.createElement("span",{className:"delete-user",onClick:this.deleteUserProfile.bind(this)},React.createElement("i",{className:"icon-extended icon-denied"}),React.createElement("span",null,this.state.translation.cancellaProfilo)),React.createElement("span",{className:"exit",onClick:this.handleLogout.bind(this)},React.createElement("span",null,this.state.translation.exit))))))}}]);return UserAccount}(React.Component);
"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeleteAccountReact=function(_React$Component){_inherits(DeleteAccountReact,_React$Component);function DeleteAccountReact(props){_classCallCheck(this,DeleteAccountReact);var _this=_possibleConstructorReturn(this,(DeleteAccountReact.__proto__||Object.getPrototypeOf(DeleteAccountReact)).call(this,props));_this.COUNTDOWN_VALUE=300;_this.onConfirmPassword=function(){var email=_this.props.user.email;var _this$state=_this.state,isLoading=_this$state.isLoading,password=_this$state.password;if(!password||password.length===0)return;if(isLoading)return;_this.setState({isLoading:true});$.post("/api/account/sessions",{email:email,password:password}).then(function(response){_this.setState(_extends({isLoading:false,hasError:!response.success,isConfirmed:response.success,countdown:_this.COUNTDOWN_VALUE},response.success?{token:response.result}:{}));if(response.success){_this.timer=setInterval(function(){var newCount=_this.state.countdown-1;_this.setState({countdown:newCount>=0?newCount:0});if(newCount===0){_this.setState({isLoading:false,hasError:false,isConfirmed:false,countdown:_this.COUNTDOWN_VALUE})}},1e3)}})};_this.onDeleteAccount=function(){var token=_this.state.token;window.open(profileData.deleteUrl+"?k="+token,"_self")};_this.state={isLoading:false,isConfirmed:false,hasError:false,password:"",token:null};return _this}_createClass(DeleteAccountReact,[{key:"countDown",value:function countDown(time){var seconds=time%60;var minutes=Math.floor(time/60);minutes=minutes.toString().length===1?"0"+minutes:minutes;seconds=seconds.toString().length===1?"0"+seconds:seconds;return minutes+":"+seconds}},{key:"render",value:function render(){var _this2=this;var translation=this.props.translation;var _state=this.state,isLoading=_state.isLoading,isConfirmed=_state.isConfirmed,hasError=_state.hasError,password=_state.password,countdown=_state.countdown;return React.createElement("div",{className:"DeleteAccountReact"},React.createElement("div",{className:"DeleteAccountReact-Confirm"},!isConfirmed&&React.createElement("div",{className:"DeleteAccountReact-Confirm--header"},React.createElement("i",{className:"icon icon-notification-ops"})),!isConfirmed?React.createElement("div",{className:"DeleteAccountReact-Confirm--content"},translation.deleteUserMainMessage):React.createElement("div",{className:"DeleteAccountReact-Confirm--countdown"},this.countDown(countdown)),React.createElement("div",{className:"DeleteAccountReact-Confirm--footer"},isConfirmed?React.createElement("span",{className:"DeleteAccount",onClick:function onClick(){return _this2.onDeleteAccount()}},translation.deleteUserConfirmMessage):React.createElement("div",{className:"DeleteAccountReact-Confirm--footer-PasswordRequest"},React.createElement("input",{className:classNames({PasswordRequest:true,"has-error":hasError}),type:"password",value:password,autoComplete:"off",onChange:function onChange(e){return _this2.setState({password:e.target.value})}}),React.createElement("button",{className:classNames({button:true,"button-yellow":true,"button-circle":true,"button-shadow":true,"button-disabled":isLoading}),onClick:function onClick(){return _this2.onConfirmPassword()}},isLoading?React.createElement(LoaderComponent,null):React.createElement("i",{className:"icon icon-arrow"}))))))}}]);return DeleteAccountReact}(React.Component);var Clock=function(_React$Component2){_inherits(Clock,_React$Component2);function Clock(){_classCallCheck(this,Clock);return _possibleConstructorReturn(this,(Clock.__proto__||Object.getPrototypeOf(Clock)).apply(this,arguments))}_createClass(Clock,[{key:"format",value:function format(time){var seconds=time%60;var minutes=Math.floor(time/60);minutes=minutes.toString().length===1?"0"+minutes:minutes;seconds=seconds.toString().length===1?"0"+seconds:seconds;return minutes+":"+seconds}},{key:"render",value:function render(){var time=this.props.time;return React.createElement("div",{className:"displayedTime"},React.createElement("h1",null,this.format(time)))}}]);return Clock}(React.Component);
"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UserProfile=function(_React$Component){_inherits(UserProfile,_React$Component);function UserProfile(props){_classCallCheck(this,UserProfile);var _this=_possibleConstructorReturn(this,(UserProfile.__proto__||Object.getPrototypeOf(UserProfile)).call(this,props));_this.setMenuTabsWidth=function(){var tabs=[].concat(_toConsumableArray(_this.state.tabs));$(".tabs").find(".menu-tab").each(function(index,tab){tabs[index].width=$(tab).outerWidth()});_this.setState({tabs:tabs})};var profile_tabs=[{title:props.booking,icon_type:"font",icon:"icon-calendar",component:UserAppointments,unread:false,hide_countries:[],width:0},{title:props.favorites,icon_type:"font",icon:"icon-heart-empty",component:UserFavorites,unread:false,hide_countries:[],width:0},{title:props.orders,icon_type:"component",icon:React.createElement(ChartIcon,null),component:ProfileOrders,unread:false,hide_countries:[],width:0},{title:props.wallet,icon_type:"component",icon:React.createElement(Wallet,null),component:ProfileWallet,unread:false,hide_countries:["gr"],width:0},{title:props.coupons,icon_type:"component",icon:React.createElement(Coupon,null),component:ProfileCoupons,unread:false,hide_countries:["gr"],width:0},{title:props.profile,icon_type:"font",icon:"icon-user",component:UserAccount,unread:false,hide_countries:[],width:0}];_this.state={currentTabIndex:0,tabs:profile_tabs.filter(function(t){return props.language.some(function(r){return t.hide_countries.indexOf(r)===-1})})};return _this}_createClass(UserProfile,[{key:"componentDidMount",value:function componentDidMount(){var panel=window.location.hash;if(panel==="#appointments"){this.setCurrentTab(0)}else if(panel==="#favourites"){this.setCurrentTab(1)}else if(panel==="#orders"){this.setCurrentTab(2)}else if(panel==="#wallet"){this.setCurrentTab(3)}else if(panel==="#coupons"){this.setCurrentTab(4)}else if(panel==="#profile"){this.setCurrentTab(5)}this.setMenuTabsWidth();window.addEventListener("resize",this.setMenuTabsWidth)}},{key:"componentWillUnmount",value:function componentWillUnmount(){window.removeEventListener("resize",this.setMenuTabsWidth)}},{key:"setCurrentTab",value:function setCurrentTab(){var currentTabIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.setState({currentTabIndex:currentTabIndex})}},{key:"closeProfile",value:function closeProfile(){$(".user-sidebar").css("animation","slide-out 0.2s");window.setTimeout(function(){(new ModalHandler).hide();$("#user").removeClass("sidebar-open")},250)}},{key:"render",value:function render(){var _this2=this;var _state=this.state,currentTabIndex=_state.currentTabIndex,tabs=_state.tabs;var CurrentView=tabs[currentTabIndex]["component"];var curPos=[].concat(_toConsumableArray(Array(currentTabIndex).keys())).reduce(function(result,current,index){result+=tabs[index].width;return result},0);return React.createElement("div",{className:"user-sidebar"},React.createElement("div",{className:"tab-wrapper"},React.createElement("div",{className:"tabs-container"},React.createElement("div",{className:"cursor",style:{width:tabs[currentTabIndex].width,transform:"translateX("+curPos+"px)",WebkitTransform:"translateX("+curPos+"px)"}}),React.createElement("div",{className:"tabs"},tabs.map(function(_ref,index){var title=_ref.title,icon_type=_ref.icon_type,icon=_ref.icon,unread=_ref.unread;return React.createElement("div",{key:index,className:unread?"unread":"menu-tab",onClick:function onClick(){return _this2.setCurrentTab(index)}},React.createElement("div",null,title),icon_type==="font"&&React.createElement("i",{className:"icon "+icon}),icon_type==="component"&&icon)}),this.props.closeButton?React.createElement("div",{className:"profile-close",onClick:function onClick(){return _this2.closeProfile()}},React.createElement("div",null,"X"),React.createElement("i",{className:"icon icon-close"})):null))),React.createElement("div",{className:"content tab-"+this.state.currentTabIndex},React.createElement(CurrentView,{translation:this.props.translation,gifcardImagePath:this.props.gifcardImage})))}}]);return UserProfile}(React.Component);UserProfile.propTypes={booking:React.PropTypes.string.isRequired,favorites:React.PropTypes.string.isRequired,orders:React.PropTypes.string.isRequired,wallet:React.PropTypes.string.isRequired,coupons:React.PropTypes.string.isRequired,profile:React.PropTypes.string.isRequired,language:React.PropTypes.array.isRequired};UserProfile.defaultProps={closeButton:true};
var Frontend={triggerClickOnADiv:function(){$("#main").on("click",".click-div",function(e){e.preventDefault();e.stopPropagation();if($(this).data("target")==="_blank"){var form=$("<form>",{action:$(this).data("url"),method:"post",target:$(this).data("target")});$("<input>").attr({type:"hidden",name:"treatments",value:$(this).data("treatments")}).appendTo(form);form.appendTo(this).submit()}else{return window.location.href=$(this).data("url")}});$("#main").on("click","#click-treatments-combos",function(e){e.preventDefault();e.stopPropagation();if($(this).data("target")==="_blank"){var form=$("<form>",{action:$(this).data("url"),method:"post",target:$(this).data("target")});$("<input>").attr({type:"hidden",name:"treatments",value:$(this).data("treatments")}).appendTo(form);form.appendTo(this).submit()}else{return window.location.href=$(this).data("url")}})},listingVenueGallery:function(){$("#venues-list").find(".venue").each(function(){if($(this).find(".venue-gallery")){var init=false;$(this).find(".venue-gallery").on("init",function(event,slick){$("#venues-list").find(".venue-gallery").css({position:"initial"});init=true});if(init){return}$(this).find(".venue-gallery").not(".slick-initialized").slick({lazyLoad:"ondemand",slidesToShow:1,slidesToScroll:1,dots:true,fade:true,cssEase:"linear",prevArrow:'<span class="previous-button"><i class="icon icon-chevron-left"></i></span>',nextArrow:'<span class="next-button"><i class="icon icon-chevron-right"></i></span>'})}})},initCookiePrivacy:function(){try{if(typeof Cookies.get("cookies-privacy")!=="undefined"){return}if(location.pathname.replace("/","").inArray(["complete-your-info"])){return}var cookieInfo1=genericTranslationData.translation.cookieInfo1;var cookieInfo2=genericTranslationData.translation.cookieInfo2;var cookieInfo3=genericTranslationData.translation.cookieInfo3;var cookieLink="/privacy";var is_wella_es_domains=["saloneswella.es","mejoressalones.es"].find(function(domain){return location.hostname.indexOf(domain)>-1});if(is_wella_es_domains){cookieInfo1="Este sitio web utiliza cookies para darte una mejor experiencia de usuario.";cookieInfo2="Obtén más información";cookieInfo3="sobre cómo utilizamos las cookies. Recuerda que si desactivas las cookies, ciertas características de este sitio web pueden no estar disponibles para ti. De lo contrario, al utilizar este sitio web, consideramos que estás de acuerdo en continuar.";cookieLink="https://www.wellacompany.com/cookie-policy"}if(location.hostname.indexOf("melhoressaloes.pt")>-1){cookieInfo1="Este site utiliza cookies para oferecer uma experiência melhor para o usuário.";cookieInfo2="Saiba mais";cookieInfo3="sobre como utilizamos os cookies. Lembre-se que se desativar os cookies, algumas funcionalidades deste site podem não ficar disponíveis para si. Ao utilizar este site, presumimos que concorda em continuar.";cookieLink="https://www.wellacompany.com/cookie-policy"}var is_truncable=(cookieInfo1+cookieInfo2+cookieInfo3).length>150;$("body").addClass("with-cookie-alert").prepend($("<div />",{id:"cookies-privacy"}).html($("<div />",{class:is_truncable?"container cookie-truncable":"container"}).append($("<div />").on("click",function(){$(this).parent().toggleClass("cookie-truncable")}).append(cookieInfo1+' <a target="_blank" rel="noopener" href="'+cookieLink+'" class="reversed">'+cookieInfo2+"</a> "+cookieInfo3).append($("<span />",{class:"icon icon-close"}).click(function(e){e.preventDefault();$("#cookies-privacy").animate({height:0},300,"easeOutExpo",function(){$(this).remove()});$("body").animate({paddingTop:0},300,"easeOutExpo",function(){$("body").removeClass("with-cookie-alert")});Cookies.set("cookies-privacy",1,{expires:365})})))));$(window).one("scroll",function(){$("#cookies-privacy span").trigger("click")})}catch(e){console.log(e)}},initCovidBanner:function(){var currentDomain=domainUtil&&domainUtil.getCurrentDomain();if(!currentDomain){return}if(currentDomain!=="uala.it"||currentDomain!=="uala.local"){return}if(typeof Cookies.get("cookies-privacy")==="undefined"){return}if(typeof Cookies.get("no-covid-19-banner")!=="undefined"){return}if(location.pathname.replace("/","").inArray(["complete-your-info"])){return}$("body").addClass("with-covid-banner").prepend($("<div />",{id:"covid-banner"}).html($("<div />",{class:"container"}).append($("<div />").append($("<div />",{class:"covid19-wrapper"}).append($("<div />",{class:"covid19-title"}).append(genericTranslationData.translation.covid19Banner.title)).append($("<div />",{class:"covid19-message"}).append(genericTranslationData.translation.covid19Banner.message))).append($("<span />",{class:"icon icon-close"}).click(function(e){e.preventDefault();$("#covid-banner").animate({height:0},300,"easeOutExpo",function(){$(this).remove()});$("body").animate({paddingTop:0},300,"easeOutExpo",function(){$("body").removeClass("with-covid-banner")});Cookies.set("no-covid-19-banner",1)})))));$(window).one("scroll",function(){$("#cookies-privacy span").trigger("click")})},initTooltips:function(){if(Device.getCurrentByMeta()!=="desktop"){return}$("body").tooltip({selector:".tip",placement:"auto",container:"body"})},initTruncator:function(){if($(".read-expand").length===0){return}var venueDetailHeight=100;$("#venue-details").children().each(function(){venueDetailHeight+=$(this).outerHeight(true)});$(".read-expand").each(function(){var maxLength=$(this).data("max-length")?$(this).data("max-length"):venueDetailHeight;$(this).truncate({max_length:maxLength,more:$(this).data("readmore"),less:$(this).data("readless"),link_prefix:"... ",link_suffix:""})});$(".read-expand").click(function(e){e.preventDefault();e.stopPropagation();if($(this).find(".truncator-link").length!==0){$(this).find(".truncator-link").trigger("click")}})},initSmoothscroll:function(){$("a.smooth").click(function(e){e.preventDefault();if(location.pathname.replace(/^\//,"")===this.pathname.replace(/^\//,"")&&location.hostname===this.hostname){var $target=$(this.hash);$target=$target.length&&$target||$('[name="'+this.hash.slice(1)+'"]');if($target.length){var targetOffset=$target.offset().top;$("html,body").animate({scrollTop:targetOffset},1e3,"easeOutExpo");return false}}});const mobileMaxWidth=860;if($(window).width()<mobileMaxWidth){if($(".scope-listing").length>0||$(".scope-search").length>0||$(".scope-venue").length>0){var headroom=new Headroom(document.querySelector("header"),{offset:10,classes:{initial:"animated",pinned:"slideDown",unpinned:"slideUp"}});headroom.init();$(".search-main-container button").click(function(event){headroom.destroy()});$(".search-main-container .cancel").click(function(event){headroom.init()})}}},initRelativePosition:function(){if(parseInt(Cookies.get("cookies-privacy"))!==1){return}if($(".venue-position-relative").length===0){return}Location.currentPosition(function(position){$(".venue-position-relative").each(function(){var distance=Frontend.calculateDistanceFromPosition(position,$(this).data("latitude"),$(this).data("longitude"));var append=$(this).data("appendText")?" "+$(this).data("appendText"):"";$(this).addClass("calculated");var distanceLabel="<span>"+distance+"</span>"+"Km"+append;$(".VenueAddress-icon").show();$(this).show().html($(this).data("icon")?'<i class="icon-extended icon-geoloc-full"></i>'+distanceLabel:distanceLabel);if(distance>=150||distance==="500+"){if(!$(this).hasClass("show-all-distances")){$(this).parents(".brand-venue-distance").hide();$(this).hide()}}})},function(){var area=$('#venues-list-filters > input[name="area"]').val();var defaultArea=typeof area==="string"&&area.length>0?JSON.parse(area):{};if(typeof defaultArea.coords!=="undefined"){$(".venue-position-relative").each(function(){var distance=Frontend.calculateDistanceFromPosition(defaultArea,$(this).data("latitude"),$(this).data("longitude"));var append=$(this).data("appendText")?" "+$(this).data("appendText"):"";$(this).addClass("calculated");var distanceLabel="<span>"+distance+"</span>"+"Km"+append;$(".VenueAddress-icon").show();$(this).show().html($(this).data("icon")?'<i class="icon-extended icon-geoloc-full"></i>'+distanceLabel:distanceLabel)})}else{$(".venue-position-relative.hide-with-no-position").hide();$(".icon-geoloc-full").hide()}})},calculateDistanceFromPosition:function(position,venueLatitude,venueLongitude){var distance=null;if("coords"in position){distance=Number(Location.locationDistanceInKilometers(position.coords,{latitude:venueLatitude,longitude:venueLongitude}).toFixed(1))}distance=distance===null?999:distance;if(parseFloat(distance)>100){distance=Math.round(parseFloat(distance)/50)*50}if(parseFloat(distance)>500){distance="500+"}return distance},initSearch:function(){if(!window.UalaSearch)return;if(!window.searchData)return;var hasForm=document.querySelector("#search-container.show-form");ReactDOM.render(React.createElement(window.UalaSearch.Search,{treatmentsUrl:searchData.treatmentsUrl,venuesUrl:searchData.venuesUrl,algoliaSearchType:searchData.algoliaSearchType,algoliaId:searchData.algoliaId,algoliaKey:searchData.algoliaKey,algoliaCountries:searchData.algoliaCountries,searchableAreas:searchableAreas,locationService:Location,submitUrl:searchData.submitUrl,showForm:hasForm,mobileBreakpoint:861,searchedParams:JSON.parse(Cookies.get("searched_params")||"{}"),onMobileFormOpen:function(){$("html, body").addClass("locked search-open");$("#search-container-wrapper").css({"z-index":"12"})},onMobileFormClose:function(){$("html, body").removeClass("locked search-open");$("#search-container-wrapper").css({"z-index":""});if($(".uala-search-react.mobile .uala-search-inline-form .react-tagsinput-tag").children("span").length>0){$(".uala-search-react.mobile .search-treatments-venues.search-form-field.complete > span").animate({scrollLeft:$(".uala-search-react.mobile .uala-search-inline-form .react-tagsinput-tag").position().left},500)}},translation:searchData.translation,currentLocale:searchData.currentLocale}),document.getElementById("search-container"))},onBackButton:function(){window.addEventListener("popstate",function(){if($("#overlay").length>0){if($("#user").attr("class")==="sidebar-open"){$("#user").removeClass("sidebar-open");(new ModalHandler).hide();history.pushState(null,null,document.URL)}}})},modalFromRedirect:function(){var hasMigrationMessage=JSON.parse($("meta[name=has-message]").attr("content"));var isFromRedirect=JSON.parse($("meta[name=is-redirect]").attr("content"));if(hasMigrationMessage&&isFromRedirect){if(Cookies.get("hideRedirectModal")===undefined){(new ModalHandler).show(React.createElement(RedirectModal),{width:690,height:480},{dismissable:true,onDismiss:function(){Cookies.set("hideRedirectModal",1,{expires:3})}})}}},languageSwitcher:function(){$("#language-switcher a").each(function(){$(this).click(function(e){Cookies.remove("searched_params")})})},whitelabel:function(){if($("#main-wrapper").hasClass("scope-venue")||$("#main-wrapper").hasClass("scope-whitelabel")){var menuElement=$("#menu-menu-principale li");if($("#menu-menu-principale").is(":visible")){menuElement.on("mouseover",function(){$(this).children(".sub-menu").show()});menuElement.on("mouseleave",function(){$(this).children(".sub-menu").hide()})}$("#mobile-menu").on("click",function(){$(".artego-whitelabel .artego-mobile-nav-holder").toggle()})}},elementIsOnScreen:function(){$.fn.isOnScreen=function(topOffset,bottomOffset){topOffset=topOffset===undefined?0:topOffset;bottomOffset=bottomOffset===undefined?0:bottomOffset;var win=$(window);var viewport={top:win.scrollTop(),left:win.scrollLeft()};viewport.right=viewport.left+win.width();viewport.bottom=viewport.top+win.height();var bounds=this.offset();bounds.top=bounds.top+topOffset;bounds.right=bounds.left+this.outerWidth();bounds.bottom=bounds.top+this.outerHeight();bounds.bottom=bounds.bottom-bottomOffset;return!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom)}},init:function(){if($("#search-container").length>0){this.initSearch()}this.triggerClickOnADiv();this.listingVenueGallery();this.initCookiePrivacy();this.initCovidBanner();this.initTooltips();this.initTruncator();this.initSmoothscroll();this.initRelativePosition();this.onBackButton();this.modalFromRedirect();this.languageSwitcher();this.whitelabel();this.elementIsOnScreen()}};$(document).ready(function(){Frontend.init()});
"use strict";$(document).ready(function(){if(profileData.userLoggedIn){$("#user").click(function(){var target=$(this);window.location.hash="appointments";target.addClass("sidebar-open");var profileData=$("#profile-data").data();ReactDOM.render(React.createElement(UserProfile,{profile:profileData.profile,favorites:profileData.favorites,orders:profileData.orders,wallet:profileData.wallet,coupons:profileData.coupons,booking:profileData.booking,translation:profileData.translation,language:profileData.language}),OVERLAY_CONTAINER);OverlayHandler.show({onDismiss:function onDismiss(){window.setTimeout(function(){target.removeClass("sidebar-open");ReactDOM.unmountComponentAtNode(OVERLAY_CONTAINER)},500)}})})}else{if(sessionStorage.length>0){Object.keys(sessionStorage).forEach(function(d){if(d.lastIndexOf("user_",0)===0){sessionStorage.removeItem(d)}if(sessionStorage[d]==="[object Object]"){sessionStorage.removeItem(d)}})}$("#user > .button").click(function(){UalaAnalytics.track("LoginStart",{category:"login"});showSignModal();Hash.init();Hash.set("sign","login");Hash.update()});$("#nav.nav-with-hamburger .nav-hamburger").click(function(){$(this).parent().addClass("active")});$("#nav.nav-with-hamburger .nav-close").click(function(){$(this).parent().removeClass("active")})}});